<div class="flex justify-center mt-3">
  <app-alert
    *ngIf="alertaTipo !== AlertaTipo.none"
    [alertaTipo]="alertaTipo"
    [alertaMessage]="alertaMessage"
    (close)="cerrarAlerta()"
  >
  </app-alert>
  <div
    class="flex justify-center items-center px-5 rounded-lg bg-colorButton hover:bg-colorButtonHover transition-colors delay-75 mr-3 font-medium"
  >
    <mat-label class="mr-3 text-white">Corporativos:</mat-label>
    <mat-select
      style="width: 200px"
      class="text-white"
      [(value)]="selectedCorporativo"
      (valueChange)="cambiaCorporativo($event)"
    >
      <mat-option
        class="w-52"
        *ngFor="let corporativo of corporativos"
        [value]="corporativo.id"
      >
        {{ corporativo.nombre }}
      </mat-option>
    </mat-select>
  </div>
</div>

<div class="w-[50%] p-[7px] bg-transparent mx-auto mt-3">
  <div class="rounded-lg shadow-md overflow-hidden">
    <div class="overflow-x-auto">
      <table #tablaMenu class="w-full">
        <thead class="bg-primario text-white">
          <th class="px-1 py-[2px] xs:w-[75px]" scope="col">
            Seleccione una empresa
          </th>
        </thead>
        <tbody class="divide-y divide-gray300">
          <tr
            [hidden]="selectedEmpresa !== 0 && registro.id !== selectedEmpresa"
            *ngFor="let registro of empresas"
            class="font-medium text-gray700 hover:bg-gray200 animation duration-200 xs:text-[8px]"
          >
            <td
              class="px-1 py-[2px]"
              (click)="cargarRegistrosRoles(registro.id)"
              [ngClass]="{ selected: registro.id === selectedEmpresa }"
            >
              <button
                type="button"
                ngbTooltip="Seleccionar empresa"
                placement="end"
                tooltipClass="my-custom-class"
                triggers="mouseenter:mouseleave"
              >
                {{ registro.nombreComercial }}
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>

<div
  class="mt-3 flex flex-wrap justify-center gap-3"
  *ngIf="muestraRoles && selectedEmpresa !== 0"
>
  <!-- Card 1: Roles -->
  <div
    class="w-[270px] h-[300px] bg-white rounded-lg p-3 shadow-md overflow-y-auto"
    @fadeScaleIn
  >
    <div
      class="border-b-2 border-[#b9dfe9] text-xs font-semibold mb-2 flex justify-between"
    >
      <p class="align-middle">
        1. Seleccione un rol

        <span
          class="ml-1 text-gray-400"
          ngbTooltip="Elija o cree un rol para asociar menús y permisos"
          placement="end"
          tooltipClass="my-custom-class"
          triggers="mouseenter:mouseleave"
        >
          <img
            src="../../../assets/info.svg"
            alt="Botón de información"
            class="inline-block w-4 h-4"
          />
        </span>
      </p>
      <button
        (click)="preparacionRolEmpresa()"
        class="bg-colorButton hover:bg-colorButtonHover transition-all text-white rounded-lg h-5 px-2"
      >
        Crear nuevo rol
      </button>
    </div>
    <table class="w-full">
      <tbody>
        <tr *ngIf="roles.length === 0">
          <td class="text-center text-gray-700 font-medium">
            No hay roles creados.
          </td>
        </tr>
        <tr
          *ngFor="let registro of roles"
          class="font-medium text-gray700 hover:bg-gray200 duration-200 xs:text-[8px]"
        >
          <td
            [ngClass]="{
              selected: registro.id === selectedRol && registro.id > 0
            }"
            (click)="cargarRegistrosMenusXPor(registro.id)"
          >
            <input
              #inputRol
              class="w-full px-2"
              type="text"
              (click)="selecccionaRol(registro.id)"
              [(ngModel)]="registro.nombre"
              (keydown.enter)="editar(registro)"
            />
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Card 2: Menús -->
  <div
    class="w-[270px] h-[300px] bg-white rounded-lg p-3 shadow-md overflow-y-auto"
    *ngIf="selectedRol && selectedEmpresa !== 0"
    @fadeScaleIn
  >
    <div class="border-b-2 border-[#b9dfe9] text-xs font-semibold mb-2">
      <p>
        2. Seleccione un menú
        <span
          class="ml-1 text-gray-400"
          ngbTooltip="Elija un menú para asociar secciones y actividades"
          placement="end"
          tooltipClass="my-custom-class"
          triggers="mouseenter:mouseleave"
        >
          <img
            src="../../../assets/info.svg"
            alt="Botón de información"
            class="inline-block w-4 h-4"
          />
        </span>
      </p>
    </div>
    <table class="w-full">
      <tbody>
        <tr *ngIf="menus.length === 0">
          <td class="text-center text-gray-700 font-medium">
            Seleccione un rol para ver los menús.
          </td>
        </tr>
        <tr
          *ngFor="let registro of menus"
          class="font-medium text-gray700 hover:bg-gray200 duration-200 xs:text-[8px]"
        >
          <td
            class="px-2"
            [ngClass]="{ selected: registro.descripcion === descripcionMenu }"
            (click)="cargarRegistrosSecciones(registro)"
          >
            {{ registro.descripcion }}
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Card 3: Secciones -->
  <div
    class="w-[270px] h-[300px] bg-white rounded-lg p-3 shadow-md overflow-y-auto"
    *ngIf="descripcionMenu"
    @fadeScaleIn
  >
    <div class="border-b-2 border-[#b9dfe9] text-xs font-semibold mb-2">
      <p>
        3. Seleccione una sección
        <span
          class="ml-1 text-gray-400"
          ngbTooltip="Elija una sección para asociar actividades"
          placement="end"
          tooltipClass="my-custom-class"
          triggers="mouseenter:mouseleave"
        >
          <img
            src="../../../assets/info.svg"
            alt="Botón de información"
            class="inline-block w-4 h-4"
          />
        </span>
      </p>
    </div>
    <table class="w-full">
      <tbody>
        <tr
          *ngFor="let registro of dataRolSeccionFiltrado"
          class="font-medium text-gray700 hover:bg-gray200 duration-200 xs:text-[8px]"
        >
          <td
            class="flex justify-between px-2 items-center"
            [ngClass]="{ selected: registro === filaseleccionada }"
            (click)="cargarRegistrosActividades(registro)"
          >
            {{ registro.descripcion }}
            <div class="form-check form-switch flex justify-center">
              <input
                class="form-check-input form-switch"
                type="checkbox"
                role="switch"
                checked
                [(ngModel)]="registro.esActivo"
                (change)="activarSeccion(registro)"
              />
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Card 4: Actividades -->
  <div
    class="w-[270px] h-[300px] bg-white rounded-lg p-3 shadow-md overflow-y-auto"
    *ngIf="dataRolActividadFiltrado && dataRolActividadFiltrado.length > 0"
    @fadeScaleIn
  >
    <div class="border-b-2 border-[#b9dfe9] text-xs font-semibold mb-2">
      <p>
        4. Seleccione la actividad
        <span
          class="ml-1 text-gray-400"
          ngbTooltip="Elija una actividad para asociar permisos al rol"
          placement="end"
          tooltipClass="my-custom-class"
          triggers="mouseenter:mouseleave"
        >
          <img
            src="../../../assets/info.svg"
            alt="Botón de información"
            class="inline-block w-4 h-4"
          />
        </span>
      </p>
    </div>
    <table class="w-full">
      <tbody>
        <tr
          *ngFor="let registro of dataRolActividadFiltrado"
          class="font-medium text-gray700 hover:bg-gray200 duration-200 xs:text-[8px]"
        >
          <td
            [ngClass]="{
              selected: registro.descripcion === descripcionSeccion
            }"
          >
            {{ registro.descripcion }}
          </td>
          <td class="text-center">
            <div class="form-check form-switch flex justify-center">
              <input
                class="form-check-input"
                type="checkbox"
                role="switch"
                checked
                [(ngModel)]="registro.esActivo"
                (change)="activarActividad(registro)"
              />
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>
