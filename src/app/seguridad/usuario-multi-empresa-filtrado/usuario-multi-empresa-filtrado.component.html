<section>
  <!-- <div class="titularUsuarios">Usuarios</div> -->

  <div class="flex justify-center mt-3">
    <div
      class="flex justify-center items-center px-5 rounded-lg bg-colorButton hover:bg-colorButtonHover transition-colors delay-75 mr-3 font-medium select-w"
    >
      <mat-label class="mr-3 text-white">Corporativos:</mat-label>
      <mat-select
        style="width: 200px; color: #f2f2f2"
        class="text-white"
        [(value)]="selectedCorporativo"
        (valueChange)="cargarRegistros($event)"
      >
        <mat-option
          class="w-52"
          *ngFor="let corporativo of corporativos"
          [value]="corporativo.id"
        >
          {{ corporativo.nombre }}
        </mat-option>
      </mat-select>
    </div>
    <!-- Button cotainer -->
    <div *ngIf="!esAdminRoles" class="flex mt-1 mb-2">
      <button
        (click)="nuevoUsuario()"
        class="flex items-center rounded-md bg-colorButton transition-colors delay-75 hover:bg-colorButtonHover font-light text-white p-1"
      >
        <p
          class="text-[#f2f2f2] titular bg-custom-bg w-52 font-medium text-base tracking-wider m-0 text-center xs:text-[10px] xs:w-24"
        >
          Nuevo usuario
        </p>
        <img class="xs:w-4" src="assets/add.svg" alt="botón agregar" />
      </button>
    </div>
    <!-- Button cotainer  end -->
  </div>

  <div style="margin-top: 10px" [@changeStyles]="currentState">
    <div
      class="cont-table orden-compra"
      style="overflow-x: auto; white-space: nowrap"
    >
      <div
        style="
          display: flex;
          justify-content: space-between;
          align-items: center;
        "
      >
        <div class="w-full flex justify-end gap-2" *ngIf="esAdmin">
          <div
            class="flex justify-center m-0 p-0 items-center gap-3 border-2 border-[#51aec7] rounded-lg px-1"
          >
            <div class="flex justify-center m-0 p-0 items-center gap-2">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="20"
                height="20
              "
                fill="#51aec7"
                class="bi bi-search"
                viewBox="0 0 16 16"
              >
                <path
                  d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001q.044.06.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1 1 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0"
                />
              </svg>
            </div>
            <input
              class="input-1 dropdown1"
              id="myInput"
              type="text"
              placeholder="Buscar usuario"
              style="margin: 5px; margin-left: -5px"
              data-bs-toggle="dropdown"
              (click)="clickInputFiltroProveedores()"
              (keyup)="filtrarProveedores($event)"
              [(ngModel)]="nombreUsuario"
            />
            <ul
              class="dropdown-menu"
              style="overflow-x: auto; white-space: nowrap; height: 300px"
            >
              <li *ngIf="esAdmin && dropdown">
                <option
                  class="option-hover"
                  *ngFor="let proveedor of dataUsuario"
                  [value]="proveedor.nombreCompleto"
                  (click)="seleccionaProveedor(proveedor)"
                >
                  {{ proveedor.nombreCompleto }}
                </option>
              </li>
            </ul>
          </div>
        </div>
      </div>
      <div class="p-2">
        <div class="overflow-x-auto shadow-md rounded-lg">
          <table
            #tablaMenu
            class="w-full text-sm"
            *ngIf="menuUsuario"
            (mouseover)="activarElemento()"
          >
            <thead class="bg-primario text-white">
              <tr>
                <th class="px-1 py-[2px]" scope="col">Nombre de usuario</th>
                <th class="px-[2px] py-[2px]" scope="col">Nombre completo</th>
                <th *ngIf="!esAdminRoles" class="px-[2px] py-[2px]" scope="col">
                  Activar
                </th>
                <th
                  *ngIf="!esAdminRoles"
                  class="px-[2px] py-[2px] text-center"
                  scope="col"
                >
                  Acciones
                </th>
              </tr>
            </thead>
            <tbody class="divide-y divide-gray300">
              <tr
                class="font-medium text-gray700 hover:bg-gray200 animation duration-200 xs:text-[8px]"
                *ngFor="
                  let registro of dataUsuario
                    | slice : inicioCopia : terminoCopia
                "
              >
                <td
                  (click)="cargarRegistrosEmpresas(registro)"
                  [ngClass]="{
                    'bg-[#b9dfe9]': registro === filaSeleccionada
                  }"
                >
                  {{ registro.nombreUsuario }}
                </td>
                <td
                  (click)="cargarRegistrosEmpresas(registro)"
                  [ngClass]="{
                    'bg-[#b9dfe9]': registro === filaSeleccionada
                  }"
                >
                  <div
                    class="ajuste-texto"
                    ngbTooltip="{{ registro.nombreCompleto }}
              "
                    placement="bottom"
                  >
                    {{ registro.nombreCompleto.slice(0, 20)
                    }}{{ registro.nombreCompleto.length <= 20 ? "" : "..." }}
                  </div>
                </td>
                <!-- <td  style="width: 377px; margin-left: 15px;" (click)="cargarRegistrosEmpresas(registro)" [ngClass]="{ 'fila-seleccionada': registro === filaSeleccionada}">{{ registro.tipo == 1 ? "Usuario normal" : registro.tipo == 2 ? "Usuario proveedor" : registro.tipo == 3 ? "Usuario gastos" : "" }}</td> -->
                <td
                  *ngIf="!esAdminRoles"
                  [ngClass]="{
                    'bg-[#b9dfe9]': registro === filaSeleccionada
                  }"
                >
                  <div class="flex items-center">
                    <label class="inline-flex items-center cursor-pointer">
                      <input
                        type="checkbox"
                        value=""
                        class="sr-only peer"
                        checked
                        [(ngModel)]="registro.activo"
                        (change)="
                          activarDesactivarUsuario(
                            registro.idUsuario,
                            registro.activo
                          )
                        "
                      />
                      <div
                        class="relative w-9 h-5 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-blue-600"
                      ></div>
                    </label>
                  </div>
                </td>
                <td
                  *ngIf="!esAdminRoles"
                  [ngClass]="{
                    'bg-[#b9dfe9]': registro === filaSeleccionada
                  }"
                >
                  <div class="flex gap-1 justify-center">
                    <button
                      class="bg-colorButton hover:bg-colorButtonHover transition-colors delay-75 rounded-md p-1"
                      (click)="modificaDatosUsuarioBase(registro)"
                      ngbTooltip="Editar Usuario"
                      placement="top"
                      triggers="mouseenter:mouseleave"
                    >
                      <img src="../../../assets/settings.svg" alt="" />
                    </button>
                    <button
                      class="bg-colorButton hover:bg-colorButtonHover transition-colors delay-75 rounded-md p-1"
                      (click)="cambiarContrasenia(registro)"
                      ngbTooltip="Cambiar Contraseña"
                      placement="start"
                      triggers="mouseenter:mouseleave"
                    >
                      <img src="../../../assets/password.svg" alt="" />
                    </button>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
          <mat-paginator
            [length]="dataUsuario.length"
            [pageSize]="20"
            aria-label="Select page"
            (page)="cambiarPaginaCopia($event)"
          >
          </mat-paginator>
        </div>
      </div>
    </div>

    <div *ngIf="tablaAsignacion" class="overflow-x-auto">
      <div>
        <p class="text-lg text-center text-gray-700 font-bold mt-2">
          Tabla de Asignación
        </p>
      </div>
      <div class="p-2">
        <div class="overflow-hidden shadow-md rounded-lg">
          <table #tablaMenu class="w-full text-sm">
            <thead class="bg-primario text-white">
              <tr>
                <th class="px-1 py-[2px]" scope="col">Nombre Empresa</th>
                <th *ngIf="!esAdminRoles" class="px-[2px] py-[2px]" scope="col">
                  Esta activo en empresa
                </th>
                <th *ngIf="!esAdminRoles" class="px-[2px] py-[2px]" scope="col">
                  Rol
                </th>
                <th
                  *ngIf="!esAdminRoles"
                  class="px-[2px] py-[2px] text-center"
                  scope="col"
                >
                  Acciones
                </th>
              </tr>
            </thead>
            <tbody class="divide-y divide-gray300">
              <tr
                *ngFor="let registro of empresasConRoles"
                class="font-medium text-gray700 hover:bg-gray200 animation duration-200 xs:text-[8px]"
              >
                <ng-container
                  *ngIf="
                    !selectedEmpresaId ||
                    selectedEmpresaId === registro.idEmpresa
                  "
                >
                  <td
                    [ngClass]="{
                      'bg-[#b9dfe9]': selectedEmpresaId === registro.idEmpresa
                    }"
                    (click)="cargarProyectos(registro)"
                  >
                    {{ registro.nombreEmpresa }}
                  </td>
                  <td
                    *ngIf="!esAdminRoles"
                    [ngClass]="{
                      'bg-[#b9dfe9]': selectedEmpresaId === registro.idEmpresa
                    }"
                  >
                    <div>
                      <input
                        class="form-check-input"
                        type="checkbox"
                        role="switch"
                        id="flexSwitchCheckChecked"
                        checked
                        (change)="activarEmpresaUsuario(registro)"
                        [(ngModel)]="registro.activoEmpresa"
                      />
                      <label
                        class="form-check-label"
                        for="flexSwitchCheckChecked"
                      ></label>
                    </div>
                  </td>
                  <td
                    *ngIf="!esAdminRoles"
                    [ngClass]="{
                      'bg-[#b9dfe9]': selectedEmpresaId === registro.idEmpresa
                    }"
                  >
                    <select
                      [(ngModel)]="registro.idRol"
                      (ngModelChange)="
                        cambiaPermisosRolAUsuario($event, registro)
                      "
                    >
                      <option
                        *ngFor="let registro2 of registro.roles"
                        [value]="registro2.id"
                      >
                        {{ registro2.nombre }}
                      </option>
                    </select>
                  </td>
                  <td
                    *ngIf="!esAdminRoles"
                    [ngClass]="{
                      'bg-[#b9dfe9]': selectedEmpresaId === registro.idEmpresa
                    }"
                  >
                    <div class="flex gap-1 justify-center">
                      <button
                        ngbTooltip="Nuevo empleado"
                        triggers="mouseenter:mouseleave"
                        placement="top"
                        (click)="seleccionEmpresaTabla(registro)"
                        class="bg-colorButton hover:bg-colorButtonHover transition-colors delay-75 rounded-md p-1"
                      >
                        <img src="../../../assets/nuevo_empleado.svg" alt="" />
                      </button>
                      <button
                        ngbTooltip="Relacionar empleado"
                        triggers="mouseenter:mouseleave"
                        placement="top"
                        (click)="seleccionEmpresaTablaRelacion(registro)"
                        class="bg-colorButton hover:bg-colorButtonHover transition-colors delay-75 rounded-md p-1"
                      >
                        <img
                          src="../../../assets/relacionar_empleado.svg"
                          alt=""
                        />
                      </button>
                    </div>
                  </td>
                </ng-container>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
    <div *ngIf="isClicked">
      <app-proyecto-usuario
        [selectedEmpresa]="selectedEmpresaId"
        [selectedUsuario]="selectedUsuario"
      ></app-proyecto-usuario>
    </div>
  </div>
</section>
