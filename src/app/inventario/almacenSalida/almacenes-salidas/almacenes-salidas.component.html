<div class="grid grid-cols-1 gap-4">
  <!-- Selector de almacén + filtros -->
  <div class="flex flex-wrap items-end justify-between gap-4 w-full">
    <!-- Selector de almacén -->
    <div class="flex gap-1 items-center">
      <label
        class="rounded-l-md bg-colorButton text-gray100 px-1 py-1 xs:text-[10px]"
        for="almacen"
        >Almacén</label
      >
      <input
        class="xs:text-[10px] xs:w-[130px]"
        list="almacendata"
        id="almacen"
        name="almacen"
        placeholder="Selecciona un almacén"
        autocomplete="off"
        (input)="SeleccionaAlmacen($event)"
      />
      <datalist id="almacendata">
        <option *ngFor="let almacen of almacenes">
          {{ almacen.almacenNombre }}
        </option>
      </datalist>
    </div>

    <!-- Filtros -->
    <div
      class="flex gap-2 items-end"
      style="
        background-color: #b9dfe9;
        padding: 5px;
        font-size: 16px;
        font-weight: 500;
        border-radius: 7px 7px 0 0;
      "
    >
      <select
        class="border-none rounded-sm bg-[#ffffff] text-[#020202d3] font-medium p-1"
        [(ngModel)]="tipoSalidaAlmacen"
        (change)="fitrarTipoSA()"
      >
        <option [value]="0">Todas las Salidas</option>
        <option [value]="1">Orden de Compra</option>
        <option [value]="2">Bajas en almacén</option>
        <option [value]="3">Salidas con préstamos</option>
      </select>
      <input
        type="date"
        min="1900-01-01"
        max="9999-01-01"
        [(ngModel)]="fechafiltro"
        (change)="fitrarTipoSA()"
      />
    </div>
  </div>

  <!-- Botones -->
  <div class="flex flex-wrap gap-2" *ngIf="idAlmacen != 0">
    <button
      (click)="NuevaSalidaAlmacen()"
      class="flex items-center rounded-md bg-colorButton transition-colors delay-75 hover:bg-colorButtonHover font-light text-white p-1"
    >
      <p
        class="text-[#f2f2f2] titular bg-custom-bg w-52 font-medium text-base tracking-wider m-0 text-center xs:text-[10px] xs:w-24"
      >
        Nueva Salida en Almacén
      </p>
      <img src="assets/add.svg" alt="" />
    </button>

    <button
      (click)="NuevaBajaAlmacen()"
      class="flex items-center rounded-md bg-colorButton transition-colors delay-75 hover:bg-colorButtonHover font-light text-white p-1"
    >
      <p
        class="text-[#f2f2f2] titular bg-custom-bg w-52 font-medium text-base tracking-wider m-0 text-center xs:text-[10px] xs:w-24"
      >
        Nueva Baja en Almacén
      </p>
      <img src="assets/add.svg" alt="" />
    </button>
  </div>
</div>

<p class="text-sm font-medium mb-2 mt-2 text-gray700 xs:text-[10px]">
  Campos obligatorios marcados con <span class="font-bold">*</span>
</p>

<!-- Tabla de salidas de almacén -->
<div class="overflow-x-auto shadow-md rounded-lg mt-2">
  <table class="w-full text-sm xs:table-fixed">
    <thead class="bg-primario text-white">
      <tr>
        <th scope="col" class="px-1 py-[2px] xs:w-[75px]">
          No. Salida Almacén
        </th>
        <th scope="col" class="px-1 py-[2px] xs:w-[70px]">Almacén</th>
        <th scope="col" class="px-1 py-[2px]">Fecha de Registro</th>
        <th scope="col" class="px-1 py-[2px]">Persona Surtió</th>
        <th scope="col" class="px-1 py-[2px]">Persona Recibió*</th>
        <th scope="col" class="px-1 py-[2px]">Observaciones*</th>
      </tr>
    </thead>
    <tbody class="divide-y divide-gray300">
      <ng-container *ngIf="isLoading">
        <tr>
          <!-- No. Salida Almacén -->
          <td class="px-1" scope="col">
            <div role="status" class="max-w-sm animate-pulse">
              <div
                class="h-5 bg-gray300 rounded-full w-28 xs:w-14 xs:h-3 mt-1 mb-1"
              ></div>
            </div>
          </td>
          <!-- Almacén -->
          <td scope="col">
            <div role="status" class="max-w-sm animate-pulse">
              <div
                class="h-5 bg-gray300 rounded-full w-40 xs:w-14 xs:h-3 mt-1 mb-1"
              ></div>
            </div>
          </td>
          <!-- Fecha de registro -->
          <td scope="col">
            <div role="status" class="max-w-sm animate-pulse">
              <div
                class="h-5 bg-gray300 rounded-full w-32 xs:w-14 xs:h-3 mt-1 mb-1"
              ></div>
            </div>
          </td>
          <!-- Persona Surtió -->
          <td class="px-1" scope="col">
            <div role="status" class="max-w-sm animate-pulse">
              <div
                class="h-5 bg-gray300 rounded-full w-48 xs:w-14 xs:h-3 mt-1 mb-1"
              ></div>
            </div>
          </td>
          <!-- Persona Recibió -->
          <td class="px-1" scope="col">
            <div role="status" class="max-w-sm animate-pulse">
              <div
                class="h-5 bg-gray300 rounded-full w-48 xs:w-14 xs:h-3 mt-1 mb-1"
              ></div>
            </div>
          </td>
          <!-- Observaciones -->
          <td class="px-1" scope="col">
            <div role="status" class="max-w-sm animate-pulse">
              <div
                class="h-5 bg-gray300 rounded-full w-48 xs:w-14 xs:h-3 mt-1 mb-1"
              ></div>
            </div>
          </td>
        </tr>
        <tr>
          <!-- No. Salida Almacén -->
          <td class="px-1" scope="col">
            <div role="status" class="max-w-sm animate-pulse">
              <div
                class="h-5 bg-gray300 rounded-full w-28 xs:w-14 xs:h-3 mt-1 mb-1"
              ></div>
            </div>
          </td>
          <!-- Almacén -->
          <td scope="col">
            <div role="status" class="max-w-sm animate-pulse">
              <div
                class="h-5 bg-gray300 rounded-full w-40 xs:w-14 xs:h-3 mt-1 mb-1"
              ></div>
            </div>
          </td>
          <!-- Fecha de registro -->
          <td scope="col">
            <div role="status" class="max-w-sm animate-pulse">
              <div
                class="h-5 bg-gray300 rounded-full w-32 xs:w-14 xs:h-3 mt-1 mb-1"
              ></div>
            </div>
          </td>
          <!-- Persona Surtió -->
          <td class="px-1" scope="col">
            <div role="status" class="max-w-sm animate-pulse">
              <div
                class="h-5 bg-gray300 rounded-full w-48 xs:w-14 xs:h-3 mt-1 mb-1"
              ></div>
            </div>
          </td>
          <!-- Persona Recibió -->
          <td class="px-1" scope="col">
            <div role="status" class="max-w-sm animate-pulse">
              <div
                class="h-5 bg-gray300 rounded-full w-48 xs:w-14 xs:h-3 mt-1 mb-1"
              ></div>
            </div>
          </td>
          <!-- Observaciones -->
          <td class="px-1" scope="col">
            <div role="status" class="max-w-sm animate-pulse">
              <div
                class="h-5 bg-gray300 rounded-full w-48 xs:w-14 xs:h-3 mt-1 mb-1"
              ></div>
            </div>
          </td>
        </tr>
        <tr>
          <!-- No. Salida Almacén -->
          <td class="px-1" scope="col">
            <div role="status" class="max-w-sm animate-pulse">
              <div
                class="h-5 bg-gray300 rounded-full w-28 xs:w-14 xs:h-3 mt-1 mb-1"
              ></div>
            </div>
          </td>
          <!-- Almacén -->
          <td scope="col">
            <div role="status" class="max-w-sm animate-pulse">
              <div
                class="h-5 bg-gray300 rounded-full w-40 xs:w-14 xs:h-3 mt-1 mb-1"
              ></div>
            </div>
          </td>
          <!-- Fecha de registro -->
          <td scope="col">
            <div role="status" class="max-w-sm animate-pulse">
              <div
                class="h-5 bg-gray300 rounded-full w-32 xs:w-14 xs:h-3 mt-1 mb-1"
              ></div>
            </div>
          </td>
          <!-- Persona Surtió -->
          <td class="px-1" scope="col">
            <div role="status" class="max-w-sm animate-pulse">
              <div
                class="h-5 bg-gray300 rounded-full w-48 xs:w-14 xs:h-3 mt-1 mb-1"
              ></div>
            </div>
          </td>
          <!-- Persona Recibió -->
          <td class="px-1" scope="col">
            <div role="status" class="max-w-sm animate-pulse">
              <div
                class="h-5 bg-gray300 rounded-full w-48 xs:w-14 xs:h-3 mt-1 mb-1"
              ></div>
            </div>
          </td>
          <!-- Observaciones -->
          <td class="px-1" scope="col">
            <div role="status" class="max-w-sm animate-pulse">
              <div
                class="h-5 bg-gray300 rounded-full w-48 xs:w-14 xs:h-3 mt-1 mb-1"
              ></div>
            </div>
          </td>
        </tr>
      </ng-container>
      <tr
        *ngFor="let sa of salidasalmacen"
        [ngClass]="{ 'background-color': sa.id == changeColor }"
        (click)="VerInsumosXSalidaAlmacen(sa)"
        class="font-medium text-gray700 hover:bg-gray200 animation duration-200 xs:text-[8px]"
      >
        <td class="px-1 py-[2px]">{{ sa.codigoSalida }}</td>
        <td class="px-1 py-[2px]">{{ sa.almacenNombre }}</td>
        <td class="px-1 py-[2px]">
          {{ sa.fechaRegistro | date : "dd-MM-yyyy" }}
        </td>
        <td class="px-1 py-[2px]">{{ sa.personaSurtio }}</td>
        <td class="px-1 py-[2px]">
          <ng-container *ngIf="sa.estatus == 2">
            {{ sa.personaRecibio }}
          </ng-container>
          <ng-container *ngIf="sa.estatus == 1">
            <input
              class="w-full bg-transparent"
              type="text"
              [(ngModel)]="sa.personaRecibio"
              (keydown.enter)="actualizarSalidaAlmacen(sa)"
            />
          </ng-container>
        </td>
        <td class="px-1 py-[2px]">
          <input
            class="w-full bg-transparent"
            type="text"
            [(ngModel)]="sa.observaciones"
            (keydown.enter)="actualizarSalidaAlmacen(sa)"
          />
        </td>
      </tr>
    </tbody>
  </table>
</div>

<!-- Tabla de insumos -->
<div
  *ngIf="
    insumosDisponibles.length > 0 && idAlmacen != 0 && idSalidaAlmacen != 0
  "
  class="overflow-x-auto shadow-md rounded-lg mt-10"
>
  <table class="w-full text-sm xs:table-fixed">
    <thead class="bg-primario text-white">
      <tr>
        <th scope="col" class="px-1 py-[2px]">Descripción</th>
        <th scope="col" class="px-1 py-[2px]">Unidad</th>
        <th scope="col" class="px-1 py-[2px]">Cantidad Disponible</th>
        <th scope="col" class="px-1 py-[2px]">Cantidad Por Salir*</th>
        <th scope="col" class="px-1 py-[2px]">Es Préstamo</th>
      </tr>
    </thead>
    <tbody class="divide-y divide-gray300">
      <tr
        class="font-medium text-gray700 hover:bg-gray200 animation duration-200 xs:text-[8px]"
      >
        <td class="px-1 py-[2px]">
          <input
            class="bg-transparent w-full"
            list="insumodata"
            id="insumo"
            name="insumo"
            placeholder="Buscar"
            [(ngModel)]="insumoInformacion.descripcion"
            autocomplete="off"
            (input)="informacionInsumo($event)"
          />
          <datalist id="insumodata">
            <option *ngFor="let insumo of insumosDisponibles">
              {{ insumo.descripcion }}
            </option>
          </datalist>
        </td>
        <td class="px-1 py-[2px]">
          {{ insumoInformacion.unidad }}
        </td>
        <td class="px-1 py-[2px]">
          {{ insumoInformacion.cantidadDisponible }}
        </td>
        <td class="px-1 py-[2px]">
          <input
            class="bg-transparent w-full"
            type="number"
            [(ngModel)]="insumoInformacion.cantidadPorSalir"
            (keydown.enter)="guardarSalidaInsumo()"
          />
        </td>
        <td class="px-1 py-[2px]">
          <input
            type="checkbox"
            [(ngModel)]="insumoInformacion.esPrestamo"
            *ngIf="!esBaja"
          />
        </td>
      </tr>
    </tbody>
  </table>
</div>

<!-- Componente de detalle de insumos -->
<div *ngIf="idSalidaAlmacen != 0">
  <app-almacen-salida-insumos
    *appRecarga="appRegarga"
    [idEmpresaInput]="idEmpresaInput"
    [idSalidaAlmacenInput]="idSalidaAlmacen"
    [idProyectoInput]="idProyectoInput"
  >
  </app-almacen-salida-insumos>
</div>
