<div class="w-full flex justify-between xs:block">
  <div class="flex gap-2">
    <!-- Almacén -->
    <div class="flex mt-2 mb-2 gap-1">
      <!-- <label class="labelProyecto" for="almacen">Almacén</label>
      <select class="form-control dropdown1 w-full bg-transparent text-sm">
        <option value="" disabled selected>Seleccionar almacén</option>
        <option
          *ngFor="let almacen of almacenes"
          [value]="almacen.almacenNombre"
        >
          {{ almacen.almacenNombre }}
        </option>
      </select> -->
      <label
        class="rounded-l-md bg-colorButton text-gray100 px-1 py-1 xs:text-[10px]"
        for="almacen"
        >Almacen</label
      >
      <input
        class="xs:text-[10px] xs:w-[130px]"
        list="almacendata"
        id="almacen"
        name="almacen"
        placeholder="Selecciona un almacen "
        autocomplete="off"
        (input)="SeleccionaAlmacen($event)"
      />
      <datalist id="almacendata">
        <option *ngFor="let almacen of almacenes">
          {{ almacen.almacenNombre }}
        </option>
      </datalist>
    </div>
    <!-- Almacén end-->

    <div
      *ngIf="idAlmacen != 0 && idRequisicionInput == 0"
      class="flex items-end"
    >
      <button
        (click)="NuevaEntradaAlmacen()"
        class="flex align-items-center rounded-md bg-colorButton transition-colors delay-75 hover:bg-colorButtonHover font-light text-white p-1"
      >
        <p
          class="text-[#f2f2f2] titular bg-custom-bg w-52 font-medium text-base tracking-wider m-0 text-center xs:text-[10px] xs:w-24"
        >
          Nueva Entrada a Almacén
        </p>
        <img src="assets/add.svg" alt="" />
      </button>
    </div>
    <div
      *ngIf="idAlmacen != 0 && idRequisicionInput == 0"
      class="flex items-end"
    >
      <button
        (click)="NuevoAjusteAlmacen()"
        class="flex align-items-center rounded-md bg-colorButton transition-colors delay-75 hover:bg-colorButtonHover font-light text-white p-1"
      >
        <p
          class="text-[#f2f2f2] titular bg-custom-bg w-52 font-medium text-base tracking-wider m-0 text-center xs:text-[10px] xs:w-24"
        >
          Nuevo Ajuste en Almacén
        </p>
        <img src="assets/add.svg" alt="" />
      </button>
    </div>
  </div>

  <div class="flex justify-center items-center gap-2 xs:block">
    <select
      class="border-none rounded-sm bg-[#ffffff] text-gray700 font-medium text-sm p-1 xs:text-[10px]"
      [(ngModel)]="tipoEntradaAlmacen"
      (change)="fitrarTipoEA()"
    >
      <option [value]="0">Todas las Entradas</option>
      <option [value]="1">Orden de Compra</option>
      <option [value]="2" *ngIf="idRequisicionInput == 0">
        Ajuste de Almacén
      </option>
      <option [value]="3">Devolucion de Prestamos</option>
    </select>

    <input
      class="mt-2 mb-2"
      type="date"
      min="1900-01-01"
      max="9999-01-01"
      [(ngModel)]="fechafiltro"
      (change)="fitrarTipoEA()"
    />
  </div>
  <button
    class="rounded-lg text-white bg-colorButton hover:bg-colorButtonHover transition-colors delay-75 xs:text-[10px] xs:w-20 xs:mb-2"
    (click)="verTodos()"
    *ngIf="todos"
  >
    Ver todos
  </button>
</div>

<p class="text-sm font-medium mb-1 text-gray700 xs:text-[10px]">
  Campos editables marcados con <span class="font-bold">*</span>
</p>

<div class="p-[5px] bg-transparent">
  <div class="rounded-lg shadow-md overflow-hidden">
    <div class="overflow-x-auto">
      <table class="w-full text-sm text-left">
        <thead class="bg-primario text-white">
          <tr class="xs:text-[10px]">
            <th class="px-1 py-[1px] min-w-2" scope="col">No.Entrada</th>
            <th class="px-[2px] py-[1px] min-w-2" scope="col">Almacén</th>
            <th class="px-[2px] py-[1px] min-w-2" scope="col">
              Persona Registro
            </th>
            <th class="px-[2px] py-[1px] min-w-2" scope="col">Registro</th>
            <th class="px-[2px] py-[1px] min-w-2" scope="col">Proveedor*</th>
            <th class="px-[2px] py-[1px] min-w-2" scope="col">
              Observaciones*
            </th>
            <th class="px-[2px] py-[1px] min-w-2 text-center" scope="col">
              Insumos
            </th>
          </tr>
        </thead>
        <tbody class="divide-y divide-gray300">
          <ng-container *ngIf="isLoading">
            <tr>
              <!-- No. Entrada -->
              <td class="px-1" scope="col">
                <div role="status" class="max-w-sm animate-pulse">
                  <div
                    class="h-5 bg-gray300 rounded-full w-28 xs:w-14 xs:h-3 mt-1 mb-1"
                  ></div>
                </div>
              </td>
              <!-- Almacen -->
              <td scope="col">
                <div role="status" class="max-w-sm animate-pulse">
                  <div
                    class="h-5 bg-gray300 rounded-full w-28 xs:w-14 xs:h-3 mt-1 mb-1"
                  ></div>
                </div>
              </td>
              <!-- Persona Registro -->
              <td scope="col">
                <div role="status" class="max-w-sm animate-pulse">
                  <div
                    class="h-5 bg-gray300 rounded-full w-32 xs:w-14 xs:h-3 mt-1 mb-1"
                  ></div>
                </div>
              </td>
              <!-- Registro -->
              <td class="px-1" scope="col">
                <div role="status" class="max-w-sm animate-pulse">
                  <div
                    class="h-5 bg-gray300 rounded-full w-28 xs:w-14 xs:h-3 mt-1 mb-1"
                  ></div>
                </div>
              </td>
              <!-- Proveedor -->
              <td scope="col">
                <div role="status" class="max-w-sm animate-pulse">
                  <div
                    class="h-5 bg-gray300 rounded-full w-40 mt-1 mb-1 xs:h-3 mt-1 mb-1"
                  ></div>
                </div>
              </td>
              <!-- Observaciones -->
              <td scope="col">
                <div role="status" class="max-w-sm animate-pulse">
                  <div
                    class="h-5 bg-gray300 rounded-full w-28 mt-1 mb-1 xs:h-3 mt-1 mb-1"
                  ></div>
                </div>
              </td>
              <!-- Insumos -->
              <td scope="col">
                <div
                  role="status"
                  class="flex justify-center max-w-sm animate-pulse"
                >
                  <div
                    class="h-5 bg-gray300 rounded-full w-32 mt-1 mb-1 xs:h-3 mt-1 mb-1"
                  ></div>
                </div>
              </td>
            </tr>
            <tr>
              <!-- No. Entrada -->
              <td class="px-1" scope="col">
                <div role="status" class="max-w-sm animate-pulse">
                  <div
                    class="h-5 bg-gray300 rounded-full w-28 xs:w-14 xs:h-3 mt-1 mb-1"
                  ></div>
                </div>
              </td>
              <!-- Almacen -->
              <td scope="col">
                <div role="status" class="max-w-sm animate-pulse">
                  <div
                    class="h-5 bg-gray300 rounded-full w-28 xs:w-14 xs:h-3 mt-1 mb-1"
                  ></div>
                </div>
              </td>
              <!-- Persona Registro -->
              <td scope="col">
                <div role="status" class="max-w-sm animate-pulse">
                  <div
                    class="h-5 bg-gray300 rounded-full w-32 xs:w-14 xs:h-3 mt-1 mb-1"
                  ></div>
                </div>
              </td>
              <!-- Registro -->
              <td class="px-1" scope="col">
                <div role="status" class="max-w-sm animate-pulse">
                  <div
                    class="h-5 bg-gray300 rounded-full w-28 xs:w-14 xs:h-3 mt-1 mb-1"
                  ></div>
                </div>
              </td>
              <!-- Proveedor -->
              <td scope="col">
                <div role="status" class="max-w-sm animate-pulse">
                  <div
                    class="h-5 bg-gray300 rounded-full w-40 mt-1 mb-1 xs:h-3 mt-1 mb-1"
                  ></div>
                </div>
              </td>
              <!-- Observaciones -->
              <td scope="col">
                <div role="status" class="max-w-sm animate-pulse">
                  <div
                    class="h-5 bg-gray300 rounded-full w-28 mt-1 mb-1 xs:h-3 mt-1 mb-1"
                  ></div>
                </div>
              </td>
              <!-- Insumos -->
              <td scope="col">
                <div
                  role="status"
                  class="flex justify-center max-w-sm animate-pulse"
                >
                  <div
                    class="h-5 bg-gray300 rounded-full w-32 mt-1 mb-1 xs:h-3 mt-1 mb-1"
                  ></div>
                </div>
              </td>
            </tr>
            <tr>
              <!-- No. Entrada -->
              <td class="px-1" scope="col">
                <div role="status" class="max-w-sm animate-pulse">
                  <div
                    class="h-5 bg-gray300 rounded-full w-28 xs:w-14 xs:h-3 mt-1 mb-1"
                  ></div>
                </div>
              </td>
              <!-- Almacen -->
              <td scope="col">
                <div role="status" class="max-w-sm animate-pulse">
                  <div
                    class="h-5 bg-gray300 rounded-full w-28 xs:w-14 xs:h-3 mt-1 mb-1"
                  ></div>
                </div>
              </td>
              <!-- Persona Registro -->
              <td scope="col">
                <div role="status" class="max-w-sm animate-pulse">
                  <div
                    class="h-5 bg-gray300 rounded-full w-32 xs:w-14 xs:h-3 mt-1 mb-1"
                  ></div>
                </div>
              </td>
              <!-- Registro -->
              <td class="px-1" scope="col">
                <div role="status" class="max-w-sm animate-pulse">
                  <div
                    class="h-5 bg-gray300 rounded-full w-28 xs:w-14 xs:h-3 mt-1 mb-1"
                  ></div>
                </div>
              </td>
              <!-- Proveedor -->
              <td scope="col">
                <div role="status" class="max-w-sm animate-pulse">
                  <div
                    class="h-5 bg-gray300 rounded-full w-40 mt-1 mb-1 xs:h-3 mt-1 mb-1"
                  ></div>
                </div>
              </td>
              <!-- Observaciones -->
              <td scope="col">
                <div role="status" class="max-w-sm animate-pulse">
                  <div
                    class="h-5 bg-gray300 rounded-full w-28 mt-1 mb-1 xs:h-3 mt-1 mb-1"
                  ></div>
                </div>
              </td>
              <!-- Insumos -->
              <td scope="col">
                <div
                  role="status"
                  class="flex justify-center max-w-sm animate-pulse"
                >
                  <div
                    class="h-5 bg-gray300 rounded-full w-32 mt-1 mb-1 xs:h-3 mt-1 mb-1"
                  ></div>
                </div>
              </td>
            </tr>
          </ng-container>
          <ng-container *ngFor="let ae of entradasalmacen">
            <tr *ngIf="entradasalmacen.length == 0">
              <td
                class="text-center text-gray-700 font-medium py-1"
                colspan="8"
              >
                No hay entradas de almacén registradas.
              </td>
            </tr>
            <tr
              class="font-medium text-gray700 hover:bg-gray200 animation duration-200 py-2"
              [ngClass]="{ 'change-background-color': ae.id == changeColor }"
              *ngIf="!EntradaAlmacenSeleccionada || ae.id === changeColor"
            >
              <td class="px-1 py-[2px] min-w-2" scope="col">
                {{ ae.noEntrada }}
              </td>
              <td class="px-1 py-[2px] min-w-2" scope="col">
                {{ ae.nombreAlmacen }}
              </td>
              <td class="px-1 py-[2px] min-w-2" scope="col">
                {{ ae.personaRegistra }}
              </td>
              <td class="px-1 py-[2px] min-w-2" scope="col">
                {{ ae.fechaRegistro | date : "dd-MM-yyyy" }}
              </td>
              <td
                class="px-1 py-[2px] min-w-2"
                scope="col"
                *ngIf="ae.estatus == 0 && ae.idContratista != 0"
              >
                {{ ae.representanteLegal }}
              </td>
              <td
                class="px-1 py-[2px] min-w-2"
                scope="col"
                *ngIf="ae.estatus == 1 && ae.idContratista != 0"
              >
                {{ ae.representanteLegal }}
              </td>
              <td
                class="px-1 py-[2px] min-w-2"
                scope="col"
                *ngIf="ae.estatus == 2 && ae.idContratista == 0"
              >
                {{ ae.representanteLegal }}
              </td>
              <td
                class="px-1 py-[2px] min-w-2"
                scope="col"
                *ngIf="ae.estatus == 3 && ae.idContratista == 0"
              >
                {{ ae.representanteLegal }}
              </td>

              <td scope="col" *ngIf="ae.idContratista == 0 && ae.estatus == 1">
                <input
                  placeholder="Proveedor..."
                  class="dropdown1 w-full bg-transparent"
                  list="insumodata"
                  id="insumo"
                  name="insumo"
                  autocomplete="off"
                  (keydown.enter)="actualizarEntradaAlmacen(ae)"
                  [(ngModel)]="ae.representanteLegal"
                />
                <datalist id="insumodata">
                  <option *ngFor="let c of contratista">
                    {{ c.representanteLegal }}
                  </option>
                </datalist>
              </td>
              <td class="px-1 py-[2px] min-w-2" scope="col">
                <input
                  placeholder="Descripción..."
                  autocomplete="off"
                  autocomplete="off"
                  class="dropdown1 w-full bg-transparent"
                  type="text"
                  data-bs-toggle="dropdown"
                  [(ngModel)]="ae.observaciones"
                  (keydown.enter)="actualizarEntradaAlmacen(ae)"
                />
              </td>
              <td scope="col">
                <div *ngIf="!insumosEstado">
                  <img
                    ngbTooltip="Ver insumos"
                    triggers="mouseenter:mouseleave"
                    class="cursor-pointer mx-auto"
                    src="../../../../assets/visibility_btn.svg"
                    alt="ver insumos"
                    (click)="VerInsumosXEntradaAlmacen(ae)"
                  />
                </div>
                <div *ngIf="insumosEstado">
                  <img
                    ngbTooltip="Cerrar insumos"
                    triggers="mouseenter:mouseleave"
                    class="cursor-pointer mx-auto"
                    src="../../../../assets/visibility-off_btn.svg"
                    alt="cerrar insumos"
                    (click)="CerrarInsumosXEntradaAlmacen()"
                  />
                </div>
              </td>
            </tr>
          </ng-container>
        </tbody>
      </table>
    </div>
  </div>
</div>

<div *ngIf="esAjusteAlmacen">
  <div class="p-[5px] bg-transparent">
    <div class="rounded-lg shadow-md overflow-hidden">
      <div class="overflow-x-auto">
        <table class="w-full">
          <thead class="bg-primario text-white">
            <tr>
              <th class="px-1 py-[1px] min-w-2" scope="col">Descripción</th>
              <th class="px-[2px] py-[1px] min-w-2" scope="col">Unidad</th>
              <th class="px-[2px] py-[1px] min-w-2" scope="col">Tipo Insumo</th>
              <th class="px-[2px] py-[1px] min-w-2" scope="col">Cantidad</th>
              <!-- <th class="cabecera1" scope="col">Acciones</th> -->
            </tr>
          </thead>
          <tbody class="divide-y divide-gray300">
            <tr>
              <td class="" scope="col">
                <input
                  class="dropdown"
                  list="insumodata"
                  id="insumo"
                  name="insumo"
                  [(ngModel)]="insumoAjusteAlmacen.descripcion"
                  autocomplete="off"
                  (keydown.enter)="guardarInsumoAjusteAlmacen()"
                  (input)="informacionInsumo($event)"
                  class="bg-transparent"
                  placeholder="Buscar"
                />
                <datalist id="insumodata">
                  <option
                    *ngFor="let insumo of explocionInsumosparaRequisicion"
                  >
                    {{ insumo.descripcion }}
                  </option>
                </datalist>
              </td>
              <td class="" scope="col">
                <input
                  autocomplete="off"
                  autocomplete="off"
                  class="form-contrtrol dropdown1 bg-transparent"
                  type="text"
                  style="margin: 5px"
                  data-bs-toggle="dropdown"
                  (keydown.enter)="guardarInsumoAjusteAlmacen()"
                  [(ngModel)]="insumoAjusteAlmacen.unidad"
                />
              </td>
              <td scope="col">
                <select
                  [(ngModel)]="insumoAjusteAlmacen.idTipoInsumo"
                  [disabled]="insumoAjusteAlmacen.idInsumo > 0"
                  class="bg-transparent"
                >
                  <option
                    *ngFor="let tipoInsumo of tipoInsumos"
                    [ngValue]="tipoInsumo.id"
                  >
                    {{ tipoInsumo.descripcion }}
                  </option>
                </select>
              </td>
              <td class="" scope="col">
                <input
                  autocomplete="off"
                  autocomplete="off"
                  class="form-contrtrol dropdown1 bg-transparent"
                  type="text"
                  placeholder="Buscar"
                  style="margin: 5px"
                  data-bs-toggle="dropdown"
                  (keydown.enter)="guardarInsumoAjusteAlmacen()"
                  [(ngModel)]="insumoAjusteAlmacen.cantidadRecibida"
                />
              </td>
              <!-- <td class="" scope="col"><button
                (click)="EliminarListaInsumosXCotizacion(ioc.descripcion, ioc.unidad)">Eliminar</button>
            </td> -->
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<div *ngIf="insumosCompradosContratista.length > 0 && idRequisicionInput <= 0">
  <p class="text-center font-semibold text-lg mt-1">Registro de insumos</p>

  <div class="p-[5px] bg-transparent">
    <div class="rounded-lg shadow-md overflow-hidden">
      <div class="overflow-x-auto">
        <table class="w-full text-sm text-left">
          <thead class="bg-primario text-white">
            <tr>
              <th class="px-1 py-[1px] min-w-2" scope="col">No.Orden Compra</th>
              <th class="px-[2px] py-[1px] min-w-2" scope="col">Descripción</th>
              <th class="px-[2px] py-[1px] min-w-2" scope="col">Unidad</th>
              <th class="px-[2px] py-[1px] min-w-2" scope="col">Cantidad</th>
              <th class="px-[2px] py-[1px] min-w-2" scope="col">
                Cantidad Recibida*
              </th>
              <!-- <th class="cabecera1" scope="col">Acciones</th> -->
            </tr>
          </thead>
          <tbody class="divide-y divide-gray300">
            <tr
              class="font-medium text-gray700 hover:bg-gray200 animation duration-200 py-2"
              *ngFor="let ioc of insumosCompradosContratista"
            >
              <td scope="col">{{ ioc.noOrdenCompra }}</td>
              <td scope="col">{{ ioc.descripcion }}</td>
              <td scope="col">{{ ioc.unidad }}</td>
              <td class="text-end" scope="col">{{ ioc.cantidad }}</td>
              <td scope="col">
                <input
                  autocomplete="off"
                  autocomplete="off"
                  class="form-contrtrol bg-transparent dropdown1 text-end "
                  type="number"
                  style="margin: 5px"
                  data-bs-toggle="dropdown"
                  [(ngModel)]="ioc.cantidadRecibida"
                  (keydown.enter)="Recibir(ioc)"
                />
              </td>
              <!-- <td scope="col"><button (click)="Recibir(ioc)">Recibir</button>
          </td> -->
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<div *ngIf="EntradaAlmacenSeleccionada">
  <app-almacene-entrada-insumos
    *appRecarga="appRegarga"
    [idEmpresaInput]="idEmpresaInput"
    [idEntradaAlmacenInput]="idEntradaAlmacen"
  ></app-almacene-entrada-insumos>
</div>
