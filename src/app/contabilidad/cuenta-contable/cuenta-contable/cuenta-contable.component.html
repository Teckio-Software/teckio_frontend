<div class="flex">
  <button
    (click)="openDialogAddCuentaContable()"
    class="flex align-items-center rounded-md bg-colorButton transition-colors delay-75 hover:bg-colorButtonHover font-light text-white p-1"
  >
    <p
      class="text-[#f2f2f2] titular bg-custom-bg w-52 font-medium text-base tracking-wider m-0 text-center xs:text-[10px] xs:w-24"
    >
      Nueva cuenta contable
    </p>
    <img src="assets/add.svg" alt="" />
  </button>
</div>
<!--
<mat-tree
  [dataSource]="dataSource"
  [treeControl]="treeControl"
  class="example-tree" class="none">
    <mat-nested-tree-node *matTreeNodeDef="let node">
        <div class="mat-tree-node"
          [ngClass]="{nivel1: node.nivel == 1,
          nivel2: node.nivel == 2,
          nivel3: node.nivel == 3,
          nivel4: node.nivel == 4,
          nivel5: node.nivel == 5,
          nivel6: node.nivel == 6,
          nivel7: node.nivel == 7}">
          <li style="height: 60px; border-right: none; border-left: 1px solid; border-top: 1px solid; border-bottom: 1px solid; position: absolute; left: 0px; width: 29.8%; z-index: 0;"
          [ngClass]="{nivel1: node.nivel == 1,
            nivel2: node.nivel == 2,
            nivel3: node.nivel == 3,
            nivel4: node.nivel == 4,
            nivel5: node.nivel == 5,
            nivel6: node.nivel == 6,
            nivel7: node.nivel == 7}">
          </li>
          <li style="height: 60px; z-index: 2;">
            <button
              mat-icon-button
              matTreeNodeToggle
              [attr.aria-label]="'toggle ' + node.name">
              <mat-icon class="mat-icon-rtl-mirror">
                {{treeControl.isExpanded(node) ? (node.hijos.length > 0 ? 'expand_more' : '') : (node.hijos.length > 0 ? 'chevron_right' : '' ) }}
              </mat-icon>
            </button>
          </li>
          <li style="height: 60px;">
            <button
              *ngIf="node.nivel < 7"
              mat-icon-button
              [attr.aria-label]="'toggle ' + node.name"
              (click)="crearCuentaContable(node)">
              <mat-icon class="mat-icon-rtl-mirror"> {{'new_label'}} </mat-icon>
            </button>
          </li>
          <li style="height: 60px; z-index: 2;">
            <p style="margin-top: 20px; text-align: center;">{{node.codigo}}</p>
          </li>
          <li style="width: 10%; right: 60%; height: 60px; position: absolute; border: 1px solid; ">
            <input #descripcion matInput class="inputEnTabla" maxlength="100" type="text" [(ngModel)]="node.descripcion" (keyup)="onKeyUp('descripcion', node, descripcion.value)"
            style="width: 98%; height: 98%;"
            [ngClass]="{nivel1: node.nivel == 1,
              nivel2: node.nivel == 2,
              nivel3: node.nivel == 3,
              nivel4: node.nivel == 4,
              nivel5: node.nivel == 5,
              nivel6: node.nivel == 6,
              nivel7: node.nivel == 7}      "/>
          </li>
          <li style="width: 10%; right: 50%; height: 60px; position: absolute; border: 1px solid; ">
            <p style="margin-top: 20px; text-align: center;">{{node.descripcionRubro}}</p>
          </li>
          <li style="width: 10%; right: 40%; height: 60px; position: absolute; border: 1px solid; ">
            <p style="margin-top: 20px; text-align: center;">{{node.tipoMoneda}}</p>
          </li>
          <li style="width: 10%; right: 30%; height: 60px; position: absolute; border: 1px solid; ">
            <p style="margin-top: 20px; text-align: center;">{{node.saldoInicial}}</p>
          </li>
          <li style="width: 10%; right: 20%; height: 60px; position: absolute; border: 1px solid; ">
            <p style="margin-top: 20px; text-align: center;">{{node.saldoFinal}}</p>
          </li>
          <li style="width: 10%; right: 10%; height: 60px; position: absolute; border: 1px solid; ">
            <p style="margin-top: 20px; text-align: center;">{{node.presupuesto}}</p>
          </li>
          <li style="width: 10%; right: 0%; height: 60px; position: absolute; border: 1px solid;">
            <p style="margin-top: 20px; text-align: center;">{{node.descripcionCodigoAgrupadorSat}}</p>
          </li>
        </div>
        <ul [class.example-tree-invisible]="!treeControl.isExpanded(node)">
          <ng-container matTreeNodeOutlet></ng-container>
        </ul>

    </mat-nested-tree-node>
</mat-tree> -->

<div class="overflow-x-auto shadow-md rounded-lg mt-3">
  <table class="w-full text-sm table table-striped table-hover table-arbol">
    <thead class="bg-primario text-white">
      <th style="width: 5%"></th>
      <th style="width: 17%" class="cabecera">Código</th>
      <th style="width: 26%" class="cabecera">Descripción</th>
      <th style="width: 10%" class="cabecera">Rubro</th>
      <th style="width: 10%" class="cabecera">Moneda</th>
      <th style="width: 14%" class="cabecera">Código agrupador</th>
      <th style="width: 8%" class="cabecera">Cuenta empresa</th>
      <th style="width: 10%" class="cabecera">Tipo</th>
    </thead>
  </table>
  <tree-view [treeData]="cuentasContables">
    <ng-template let-cuentaContable>
      <table class="table table-striped table-hover table-arbol">
        <tbody>
          <tr
            [ngClass]="{
              nivel1: cuentaContable.nivel == 1,
              nivel2: cuentaContable.nivel == 2,
              nivel3: cuentaContable.nivel == 3,
              nivel4: cuentaContable.nivel == 4,
              nivel5: cuentaContable.nivel == 5,
              nivel6: cuentaContable.nivel == 6,
              nivel7: cuentaContable.nivel == 7
            }"
          >
            <td
              style="
                width: 5%;
                color: #020202;
                border-right: 1px solid #f2f2f217;
              "
              class="cont-drill"
              [ngClass]="{
                nivel1: cuentaContable.nivel == 1,
                nivel2: cuentaContable.nivel == 2,
                nivel3: cuentaContable.nivel == 3,
                nivel4: cuentaContable.nivel == 4,
                nivel5: cuentaContable.nivel == 5,
                nivel6: cuentaContable.nivel == 6,
                nivel7: cuentaContable.nivel == 7
              }"
            >
              <div class="contenedores" style="display: flex">
                <div *ngIf="cuentaContable.hijos.length > 0">
                  <button
                    class="button-accion"
                    (click)="expansionDominio(cuentaContable)"
                    style="color: #020202"
                    *ngIf="cuentaContable.nivel < 5"
                  >
                    {{ cuentaContable.expandido ? "-" : "+" }}
                  </button>
                </div>
                <!-- <div *ngIf="cuentaContable.hijos.length <= 0">
                  <button class="button-accion"></button>
                </div> -->
                <div *ngIf="cuentaContable.hijos.length <= 0">
                    <button
                      class="w-[30px] ml-[5px] p-[0 10px]"
                      disabled
                    >
                    </button>
                  </div>
                <div
                  *ngIf="
                    cuentaContable.existePoliza == false &&
                    cuentaContable.tipoCuentaContable == 0
                  "
                >
                  <div *ngIf="cuentaContable.nivel < 5">
                    <button
                      class="button-accion"
                      (click)="crearCuentaContable(cuentaContable)"
                    >
                      <svg
                        xmlns="http://www.w3.org/2000/svg"
                        width="22"
                        height="22"
                        fill="currentColor"
                        class="bi bi-file-earmark-arrow-down-fill"
                        viewBox="0 0 16 16"
                      >
                        <path
                          d="M9.293 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V4.707A1 1 0 0 0 13.707 4L10 .293A1 1 0 0 0 9.293 0M9.5 3.5v-2l3 3h-2a1 1 0 0 1-1-1m-1 4v3.793l1.146-1.147a.5.5 0 0 1 .708.708l-2 2a.5.5 0 0 1-.708 0l-2-2a.5.5 0 0 1 .708-.708L7.5 11.293V7.5a.5.5 0 0 1 1 0"
                        />
                      </svg>
                    </button>
                  </div>
                  <div *ngIf="cuentaContable.nivel >= 5">
                    <button
                      class="w-[30px] ml-[5px] p-[0 10px]"
                      disabled
                    >
                    </button>
                  </div>
                </div>
                <div *ngIf="cuentaContable.existePoliza == true">
                  <div *ngIf="cuentaContable.nivel < 5">
                    <button class="button-accion"></button>
                  </div>
                </div>
              </div>
            </td>
            <!--------------------->
            <td
              style="
                border-right: 1px solid #3f3e3e17;
                width: 17%;
                color: #020202;
                border-right: 1px solid #f2f2f217;
              "
              class="cont-drill"
              [ngClass]="{
                nivel1Margen: cuentaContable.nivel == 1,
                nivel2Margen: cuentaContable.nivel == 2,
                nivel3Margen: cuentaContable.nivel == 3,
                nivel4Margen: cuentaContable.nivel == 4,
                nivel5Margen: cuentaContable.nivel == 5,
                nivel6Margen: cuentaContable.nivel == 6,
                nivel7Margen: cuentaContable.nivel == 7
              }"
            >
            <!-- {{cuentaContable.codigo}} -->
              {{ (cuentaContable.nivel<=1? '' : '...')+cuentaContable.codigo.substring((((cuentaContable.nivel-1)*5)), (cuentaContable.codigo.length - ((5 - cuentaContable.nivel)*5))) }}
            </td>
            <td
              style="
                border-right: 1px solid #3f3e3e17;
                width: 26%;
                color: #020202;
                border-right: 1px solid #f2f2f217;
              "
              class="cont-drill"
            >
              <input
                type="text"
                [(ngModel)]="cuentaContable.descripcion"
                style="width: 100%; background-color: transparent"
                (keydown.enter)="onKeyUp(cuentaContable)"
                #inputDescripcion
              />
              <!-- {{ cuentaContable.descripcion }} -->
            </td>
            <td
              style="
                border-right: 1px solid #3f3e3e17;
                width: 10%;
                color: #020202;
                border-right: 1px solid #f2f2f217;
              "
              class="cont-drill"
            >
              <select
                class="bg-transparent w-full"
                [(ngModel)]="cuentaContable.idRubro"
                (ngModelChange)="onKeyUp(cuentaContable)"
              >
                <option [value]="rubro.id" *ngFor="let rubro of rubros">
                  {{ rubro.descripcion }}
                </option>
              </select>
            </td>
            <td
              style="
                border-right: 1px solid #3f3e3e17;
                width: 10%;
                color: #020202;
                border-right: 1px solid #f2f2f217;
              "
              class="cont-drill"
            >
              {{ cuentaContable.tipoMoneda == 1 ? "MXN" : "USD" }}
            </td>
            <td
              style="
                border-right: 1px solid #3f3e3e17;
                width: 14%;
                color: #020202;
                border-right: 1px solid #f2f2f217;
              "
            >
              <select
                class="bg-transparent w-full"
                [(ngModel)]="cuentaContable.idCodigoAgrupadorSat"
                (ngModelChange)="onKeyUp(cuentaContable)"
              >
                <option [value]="codigo.id" *ngFor="let codigo of codigos">
                  {{ codigo.descripcion }}
                </option>
              </select>
            </td>
            <td
              style="
                border-right: 1px solid #3f3e3e17;
                width: 8%;
                color: #020202;
                border-right: 1px solid #f2f2f217;
              "
            >
              <input
                type="checkbox"
                [(ngModel)]="cuentaContable.esCuentaContableEmpresa"
                disabled
                class="w-4 h-4 text-blue-600 bg-gray-300 border-gray-300 focus:ring-blue-500"
                (ngModelChange)="onKeyUp(cuentaContable)"
              />
            </td>
            <td
              style="
                border-right: 1px solid #3f3e3e17;
                width: 10%;
                color: #020202;
                border-right: 1px solid #f2f2f217;
              "
            >
              <select
                (input)="seleccionTipoCuenta($event, cuentaContable)"
                [(ngModel)]="cuentaContable.tipoCuentaContable"
                [disabled]="
                  cuentaContable.hijos.length > 0 ||
                  !cuentaContable.esCuentaContableEmpresa
                "
              >
                <option value="0"></option>
                <option value="1">Cuenta Contable</option>
                <option value="2">IVA Acreditable</option>
                <option value="3">IVA Por Acreditar</option>
                <option value="4">Cuenta Anticipos</option>
                <option value="5">Cuenta Retención ISR</option>
                <option value="6">Cuenta Retencón IVA</option>
                <option value="7">Egresos IVA Exento</option>
                <option value="8">Egresos IVA Gravable</option>
                <option value="9">IVA Acreditable Fiscal</option>
              </select>
            </td>
          </tr>
        </tbody>
      </table>
    </ng-template>
  </tree-view>
</div>
