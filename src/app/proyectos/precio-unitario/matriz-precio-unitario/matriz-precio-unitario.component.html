<div class="relative overflow-x-auto">
  <table class="w-full text-sm rtl:text-right text-center">
    <thead class="text-center bg-[#f9fafb]">
      <th class="w-6" scope="col"></th>
      <th class="text-left font-medium py-3" scope="col">Tipo</th>
      <th class="text-left font-medium py-3" scope="col">Codigo</th>
      <th class="text-left font-medium py-3" scope="col">Descripcion</th>
      <th class="text-right font-medium py-3" scope="col">Unidad</th>
      <th class="text-right font-medium py-3" scope="col">Cantidad</th>
      <th class="text-right font-medium py-3" scope="col">Costo base</th>
      <th class="text-right font-medium py-3" scope="col">Costo unitario</th>
      <th class="text-right font-medium py-3" scope="col">Importe</th>
      <th class="text-roght font-medium py-3" scope="col">Familia</th>
    </thead>

    <tbody class="divide-y divide-gray300">
      <tr
        class="bg-white border-b"
        *ngFor="let detalle of detallesDesgloce"
        (click)="cargarRegistroDelDesglose(detalle)"
      >
        <td class="pe-1 py-[2px] w-6 text-center"></td>
        <td class="pe-1 pl-2 py-[2px] w-32">
          <select
            name=""
            id=""
            class="block w-full focus:ring-blue-500 focus:border-blue-500 font-small"
            [(ngModel)]="detalle.idTipoInsumo"
          >
            <option value="0"></option>
            <option *ngFor="let tipo of tipoInsumo" [value]="tipo.id">
              {{ tipo.descripcion }}
            </option>
          </select>
        </td>
        <td class="pe-1 py-[2px] w-auto">
          <input class="w-full" type="text" [(ngModel)]="detalle.codigo" />
        </td>
        <td class="pe-1 py-[2px] w-auto">
          <input class="w-full" type="text" [(ngModel)]="detalle.descripcion" />
        </td>
        <td class="pe-1 py-[2px] w-32">
          <!-- <input
                class="w-full text-right"
                type="text"
                [(ngModel)]="detalle.unidad"
              /> -->
        </td>
        <td class="pe-1 py-[2px] w-32">
          <input
            class="w-full text-right focus:outline-none"
            type="text"
            [ngModel]="detalle.cantidadEditado ? detalle.cantidad : detalle.cantidadConFormato"
          />
        </td>
        <td class="pe-1 py-[2px] w-32">
          <input
            class="w-full text-right focus:outline-none"
            type="text"
            [ngClass]="{
              'text-blue-700 cursor-pointer': detalle.esCompuesto,
              'text-green-600': detalle.idTipoInsumo == 10001,
              'text-black': !detalle.esCompuesto,
            }"
            [(ngModel)]="detalle.costoBaseConFormato"
            [ngModel]="
              detalle.costoUnitarioEditado ? detalle.costoBase : detalle.costoBaseConFormato
            "
            [readOnly]="detalle.esCompuesto"
          />
        </td>
        <td class="pe-1 py-[2px] w-32">
          <input
            class="w-full text-right focus:outline-none"
            type="text"
            [ngClass]="{
              'text-blue-700 cursor-pointer': detalle.esCompuesto,
              'text-green-600': detalle.idTipoInsumo == 10001,
              'text-black': !detalle.esCompuesto,
            }"
            [(ngModel)]="detalle.costoUnitarioConFormato"
          />
        </td>
        <td class="pe-1 py-[2px] w-32">
          <input
            class="w-full text-right focus:outline-none"
            type="text"
            [(ngModel)]="detalle.importeConFormato"
          />
        </td>

        <td class="pe-1 pl-2 py-[2px] w-32">
          <select
            name=""
            id=""
            class="block w-full focus:ring-blue-500 focus:border-blue-500 font-small"
            [(ngModel)]="detalle.idFamiliaInsumo"
          >
            <option value="0"></option>
            <option *ngFor="let familia of familiaInsumo" [value]="familia.id">
              {{ familia.descripcion }}
            </option>
          </select>
        </td>
      </tr>
      <tr class="bg-white border-b" *ngFor="let detalle of detalles">
        <td class="pe-1 py-[2px] w-6 text-center">
          <div class="flex justify-end items-center gap-1">
            <div class="relative menu-trigger">
              <button class="btn-opciones icon-display cursor-pointer">
                <svg
                  class="w-3 h-3"
                  aria-hidden="true"
                  xmlns="http://www.w3.org/2000/svg"
                  fill="currentColor"
                  viewBox="0 0 4 15"
                >
                  <path
                    d="M3.5 1.5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0Zm0 6.041a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0Zm0 5.959a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0Z"
                  />
                </svg>
              </button>
            </div>
          </div>
        </td>
        <td class="pe-1 pl-2 py-[2px] w-32">
          <select
            name=""
            id=""
            class="block w-full focus:ring-blue-500 focus:border-blue-500 font-small"
            [(ngModel)]="detalle.idTipoInsumo"
            (ngModelChange)="actualizarTipoInsumo(detalle, $event)"
          >
            <option [ngValue]="0"></option>
            <option *ngFor="let tipo of tipoInsumo" [ngValue]="tipo.id">
              {{ tipo.descripcion }}
            </option>
          </select>
        </td>
        <td class="pe-1 py-[2px] w-auto flex items-center">
          <img
            src="/assets/arrow-turn-up-solid-full.svg"
            class="w-4 rotate-45"
            alt=""
            *ngIf="detallesDesgloce.length > 0"
          />
          <input
            class="w-auto pl-4"
            type="text"
            [(ngModel)]="detalle.codigo"
            (click)="exponerNumeros(detalle)"
            (keydown.enter)="crearDetalle(detalle)"
          />
        </td>
        <td class="pe-1 py-[2px] w-auto">
          <input
            class="w-full"
            type="text"
            [(ngModel)]="detalle.descripcion"
            (click)="exponerNumeros(detalle)"
            (keydown.enter)="crearDetalle(detalle)"
          />
        </td>
        <td class="pe-1 py-[2px] w-32">
          <input
            class="w-full text-right"
            type="text"
            [(ngModel)]="detalle.unidad"
            (click)="exponerNumeros(detalle)"
            (keydown.enter)="crearDetalle(detalle)"
          />
        </td>
        <td class="pe-1 py-[2px] w-32">
          <input
            class="w-full text-right focus:outline-none"
            type="text"
            [ngModel]="detalle.cantidadEditado ? detalle.cantidad : detalle.cantidadConFormato"
            (click)="detalle.esCompuesto ? cargarDetallesHijos(detalle) : exponerNumeros(detalle)"
            (keydown.enter)="crearDetalle(detalle)"
            (ngModelChange)="actualizarCantidad(detalle, $event)"
          />
        </td>
        <td class="pe-1 py-[2px] w-32">
          <input
            class="w-full text-right focus:outline-none"
            type="text"
            [ngClass]="{
              'text-blue-700': detalle.esCompuesto,
              'text-green-600': detalle.idTipoInsumo == 10001,
              'text-black': !detalle.esCompuesto,
            }"
            [(ngModel)]="detalle.costoBaseConFormato"
            [ngModel]="
              detalle.costoUnitarioEditado ? detalle.costoBase : detalle.costoBaseConFormato
            "
            [readOnly]="detalle.esCompuesto"
            (click)="detalle.esCompuesto ? cargarDetallesHijos(detalle) : exponerNumeros(detalle)"
            (keydown.enter)="crearDetalle(detalle)"
            (ngModelChange)="actualizarCostoBase(detalle, $event)"
          />
        </td>
        <td class="pe-1 py-[2px] w-32">
          <input
            class="w-full text-right focus:outline-none"
            type="text"
            [ngClass]="{
              'text-blue-700': detalle.esCompuesto,
              'text-green-600': detalle.idTipoInsumo == 10001,
              'text-black': !detalle.esCompuesto,
            }"
            [(ngModel)]="detalle.costoUnitarioConFormato"
            [ngModel]="detalle.costoUnitarioConFormato"
            readonly
          />
        </td>
        <td class="pe-1 py-[2px] w-32">
          <input
            class="w-full text-right focus:outline-none"
            type="text"
            [(ngModel)]="detalle.importeConFormato"
          />
        </td>

        <td class="pe-1 pl-2 py-[2px] w-32">
          <select
            name=""
            id=""
            class="block w-full focus:ring-blue-500 focus:border-blue-500 font-small"
            [(ngModel)]="detalle.idFamiliaInsumo"
            (ngModelChange)="actualizarFamiliaInsumo(detalle, $event)"
          >
            <option [ngValue]="0"></option>
            <option *ngFor="let familia of familiaInsumo" [ngValue]="familia.id">
              {{ familia.descripcion }}
            </option>
          </select>
        </td>
      </tr>
    </tbody>
  </table>
</div>
