<section>
  <div
    *ngIf="!seCreaFactorSalarioReal"
    class="bg-white pb-4 sm:p-6 sm:pt-2 sm:pb-4 sm:w-full"
  >
    <div class="flex gap-4">
      <div class="text-center pt-1">
        <button
          type="button"
          class="leading-none top-0 right-0 px-2 text-2xl"
          (click)="cerrarExplosion()"
        >
          &times;
        </button>
      </div>
      <div class="text-center">
        <h2 class="text-xl font-semibold">Explosión de insumos</h2>
      </div>
    </div>
    <div class="flex justify-between gap-4">
      <div class="flex gap-2 pt-2 w-screen">
        <div style="width: 30%">
          <select
            (ngModelChange)="filtrarExplosion($event)"
            [(ngModel)]="idTipoInsumoSelectedParaFiltroDeExplosion"
            class="form-select mt-1 block w-full px-2 py-1 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
          >
            <option value="0">Todos</option>
            <option value="10000">Mano de obra</option>
            <option value="10001">Herramienta</option>
            <option value="10003">Equipo</option>
            <option value="10004">Material</option>
          </select>
        </div>
        <div style="width: 70%">
          <input
            type="text"
            (input)="filtrarTabla($event)"
            placeholder="Filtrado"
            [(ngModel)]="busqueda"
            class="mt-1 block w-full px-2 py-1 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
          />
        </div>
      </div>
      <div class="justify-end">
        <div
          class="flex flex-row bg-white shadow-sm rounded-t-lg p-1 items-end"
        >
          <div
            class="flex items-center justify-center flex-shrink-0 h-10 w-10 rounded-xl bg-[#4eaac138] text-[#4eaac1]"
          >
            <svg
              class="w-5 h-5"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
              ></path>
            </svg>
          </div>
          <div class="flex flex-col flex-grow ml-4">
            <div class="text-sm text-[#6b7280]">Total</div>
            <div class="font-bold text-base">
              <span>{{ importeTotalConFormato }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div
      style="
        overflow-x: auto;
        white-space: nowrap;
        width: 100%;
        margin: 0 auto;
        margin-top: 0px;
      "
      style="
        overflow-y: auto;
        white-space: nowrap;
        margin: 0 auto;
        cursor: pointer;
        max-height: 80vh;
      "
      class="overflow-x-auto shadow-md rounded-lg"
    >
      <table
        class="w-full text-sm xs:table-fixed"
      >
        <thead class="bg-primario text-white" >
          <tr class="xs:text-[10px]" >
            <th class="px-[2px] py-[2px]" scope="col" style="width: 20%">
              <div class="flex">
                <div>Codigo</div>
                <div>
                  <mat-icon
                    id="codigo"
                    class="test"
                    (click)="clickFiltroCodigo($event)"
                  >
                    {{ ordenCodigo ? " expand_less" : "expand_more" }}
                  </mat-icon>
                </div>
              </div>
            </th>
            <th class="px-[2px] py-[2px]" scope="col" style="width: 22.5%">
              <div class="flex">
                <div>Descripcion</div>
                <div>
                  <mat-icon
                    id="descripcion"
                    class="test"
                    (click)="clickFiltroCodigo($event)"
                  >
                    {{ ordenDescripcion ? " expand_less" : "expand_more" }}
                  </mat-icon>
                </div>
              </div>
            </th>
            <th class="px-[2px] py-[2px]" scope="col" style="width: 10%">
              <div class="flex">
                <div>Unidad</div>
                <div>
                  <mat-icon
                    id="unidad"
                    class="test"
                    (click)="clickFiltroCodigo($event)"
                  >
                    {{ ordenUnidad ? " expand_less" : "expand_more" }}
                  </mat-icon>
                </div>
              </div>
            </th>
            <th class="px-[2px] py-[2px]" scope="col" style="width: 10%">
              <div class="flex">
                <div>Cantidad</div>
                <div>
                  <mat-icon
                    id="cantidad"
                    class="test"
                    (click)="clickFiltroCodigo($event)"
                  >
                    {{ ordenCantidad ? " expand_less" : "expand_more" }}
                  </mat-icon>
                </div>
              </div>
            </th>
            <th class="px-[2px] py-[2px]" scope="col" style="width: 12.5%">
              <div class="flex">
                <div>Costo Base</div>
                <div>
                  <mat-icon
                    id="costob"
                    class="test"
                    (click)="clickFiltroCodigo($event)"
                  >
                    {{ ordenCostoB ? " expand_less" : "expand_more" }}
                  </mat-icon>
                </div>
              </div>
            </th>
            <th class="px-[2px] py-[2px]" scope="col" style="width: 12.5%">
              <div class="flex">
                <div>Costo Unitario</div>
                <div>
                  <mat-icon
                    id="costou"
                    class="test"
                    (click)="clickFiltroCodigo($event)"
                  >
                    {{ ordenCostoU ? " expand_less" : "expand_more" }}
                  </mat-icon>
                </div>
              </div>
            </th>
            <th class="px-[2px] py-[2px]" scope="col" style="width: 12.5%">
              <div class="flex">
                <div>Importe</div>
                <div>
                  <mat-icon
                    id="importe"
                    class="test"
                    (click)="clickFiltroCodigo($event)"
                  >
                    {{ ordenImporte ? " expand_less" : "expand_more" }}
                  </mat-icon>
                </div>
              </div>
            </th>
          </tr>
        </thead>
        <tbody class="divide-y divide-gray300">
          <tr class="font-medium text-gray700 hover:bg-gray200 animation duration-200 xs:text-[8px]"
            *ngFor="let insumo of filteredExplosion | async"
            
          >
            <td class="body-table" style="width: 20%">
              <input
                autocomplete="off"
                type="text"
                class="bg-transparent"
                id="input-table"
                [(ngModel)]="insumo.codigo"
                style="
                  background-color: rgba(0, 0, 0, 0.164);
                  border: none;
                  border-radius: 3px;
                  width: 100%;
                "
                readonly
              />
            </td>
            <td class="body-table" style="width: 22.5%">
              <input
                autocomplete="off"
                type="text"
                class="bg-transparent"
                id="input-table"
                [(ngModel)]="insumo.descripcion"
                style="
                  background-color: rgba(0, 0, 0, 0.164);
                  border: none;
                  border-radius: 3px;
                  width: 100%;
                "
                readonly
              />
            </td>
            <td class="body-table" style="width: 10%">
              <input
                autocomplete="off"
                type="text"
                class="bg-transparent"
                id="input-table"
                [(ngModel)]="insumo.unidad"
                style="
                  background-color: rgba(0, 0, 0, 0.164);
                  border: none;
                  border-radius: 3px;
                  width: 100%;
                "
                readonly
              />
            </td>
            <td class="body-table" style="width: 10%">
              <input
                autocomplete="off"
                type="text"
                class="bg-transparent"
                id="input-table"
                [(ngModel)]="insumo.cantidadConFormato"
                style="
                  background-color: rgba(0, 0, 0, 0.164);
                  border: none;
                  border-radius: 3px;
                  width: 100%;
                "
                readonly
              />
            </td>
            <td
              class="body-table"
              style="width: 12.5%"
              *ngIf="!insumo.seEstaEditandoCostoBase"
            >
              <input
                autocomplete="off"
                type="text"
                class="bg-transparent"
                id="input-table"
                [(ngModel)]="insumo.costoBaseConFormato"
                (click)="habilitarEdicionCostoBase(insumo)"
                style="
                  background-color: rgba(0, 0, 0, 0.164);
                  border: none;
                  border-radius: 3px;
                  width: 100%;
                "
                readonly
              />
            </td>
            <td
              class="body-table"
              style="width: 12.5%"
              *ngIf="insumo.seEstaEditandoCostoBase"
            >
              <input
                autocomplete="off"
                type="text"
                class="bg-transparent"
                id="input-table"
                [(ngModel)]="insumo.costoBase"
                (keydown.enter)="editarInsumo(insumo)"
                [disabled]="existenEstimaciones"
                style="
                  background-color: rgba(0, 0, 0, 0.164);
                  border: none;
                  border-radius: 3px;
                  width: 100%;
                "
              />
            </td>
            <td class="body-table" style="width: 12.5%">
              <input
                autocomplete="off"
                type="text"
                class="bg-transparent"
                id="input-table"
                [(ngModel)]="insumo.costoUnitarioConFormato"
                (dblclick)="abrirFSR(insumo)"
                style="
                  background-color: rgba(0, 0, 0, 0.164);
                  border: none;
                  border-radius: 3px;
                  width: 100%;
                "
                readonly
              />
            </td>
            <td class="body-table" style="width: 12.5%">
              <input
                autocomplete="off"
                type="text"
                class="bg-transparent"
                id="input-table"
                [(ngModel)]="insumo.importeConFormato"
                style="
                  background-color: rgba(0, 0, 0, 0.164);
                  border: none;
                  border-radius: 3px;
                  width: 100%;
                "
                readonly
              />
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</section>

<!-- Panel de Captura -->
<ng-template #dialogFactorSalarioReal>
  <div class="fixed inset-0 z-10 w-screen overflow-y-auto">
    <div
      class="content-center sm:flex min-h-full items-cen justify-center p-4 text-center sm:items-center sm:p-0"
    >
      <!-- Evita que el clic se propague al contenedor padre (overlay) -->

      <div
        class="relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-4xl"
        (click)="detenerCierre($event)"
      >
        <!-- detenerCierre(event: MouseEvent): Método que detiene la propagación del evento de clic cuando se hace clic dentro del contenido del modal, asegurando que el modal no se cierre inadvertidamente. -->
        <div class="m-2 flex justify-between">
          <h2 class="font-normal tracking-[2px] leading-8 text-base">
            Factor salario real
          </h2>
          <button
            type="button"
            class="leading-none absolute top-0 right-0 px-4 py-3 text-2xl"
            (click)="cerrarDialog()"
          >
            &times;
          </button>
        </div>
        <div class="bg-white px-4 pb-4 sm:p-6 sm:pb-4">
          <div>
            <div class="text-center mb-4">
              <!-- <h2 class="text-xl font-semibold">Factor Salario Real</h2> -->
              <div>
                <div
                  style="
                    overflow-x: auto;
                    white-space: nowrap;
                    width: 100%;
                    margin: 0 auto;
                    margin-top: 0px;
                  "
                >
                  <div class="style-encabezado-ac-act">Días no laborales</div>
                  <div
                    style="
                      overflow-y: auto;
                      white-space: nowrap;
                      margin: 0 auto;
                      cursor: pointer;
                      max-height: 150px;
                    "
                  >
                    <table
                      class="table table-striped rounded table-hover orden tabla-detalle tabla-detalle-pagos"
                    >
                      <thead style="position: sticky; top: 0">
                        <tr class="bg-zinc-400 text-white">
                          <th>Artículos de ley</th>
                          <th>Código</th>
                          <th>Descripción</th>
                          <th>Días</th>
                          <th>Acción</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr *ngFor="let dias of detallesFSINoTrabajados">
                          <td class="body-table" style="width: 20%">
                            <input
                              autocomplete="off"
                              type="text"
                              class="bg-[#f2f2f2] w-full border-none"
                              id="input-table"
                              [disabled]="existenEstimaciones"
                              class="bg-transparent"
                              [(ngModel)]="dias.articulosLey"
                              (keydown.enter)="crearDetalleFSI(dias)"
                              maxlength="500"
                            />
                          </td>
                          <td class="body-table" style="width: 20%">
                            <input
                              autocomplete="off"
                              type="text"
                              class="bg-[#f2f2f2] w-full border-none"
                              id="input-table"
                              [disabled]="existenEstimaciones"
                              class="bg-transparent"
                              [(ngModel)]="dias.codigo"
                              (keydown.enter)="crearDetalleFSI(dias)"
                              maxlength="50"
                            />
                          </td>
                          <td class="body-table" style="width: 50%">
                            <input
                              autocomplete="off"
                              type="text"
                              class="bg-[#f2f2f2] w-full border-none"
                              id="input-table"
                              [disabled]="existenEstimaciones"
                              class="bg-transparent"
                              [(ngModel)]="dias.descripcion"
                              (keydown.enter)="crearDetalleFSI(dias)"
                              maxlength="500"
                            />
                          </td>
                          <td class="body-table" style="width: 10%">
                            <input
                              autocomplete="off"
                              type="text"
                              class="bg-[#f2f2f2] w-full border-none"
                              id="input-table"
                              [disabled]="existenEstimaciones"
                              class="bg-transparent"
                              [(ngModel)]="dias.dias"
                              (keydown.enter)="crearDetalleFSI(dias)"
                            />
                          </td>
                          <td *ngIf="dias.id != 0 && !existenEstimaciones">
                            <button
                              class="button-filt"
                              placement="start"
                              ngbTooltip="Eliminar"
                              triggers="mouseenter:mouseleave"
                              (click)="EliminarDetFSI(dias)"
                            >
                              <img
                                src="assets/delete.svg"
                                alt="add cotizacion"
                              />
                            </button>
                          </td>
                          <td *ngIf="dias.id == 0 || existenEstimaciones"></td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                  <div class="flex w-full justify-end items-center mb-4">
                    Días no laborales (DNLA):
                    <input
                      autocomplete="off"
                      type="text"
                      class="bg-[#f2f2f2] text-center"
                      id="input-table"
                      [(ngModel)]="fsi.diasNoLaborales"
                      readonly
                    />
                  </div>
                </div>

                <div
                  style="
                    overflow-x: auto;
                    white-space: nowrap;
                    width: 100%;
                    margin: 0 auto;
                    margin-top: 0px;
                  "
                >
                  <div class="style-encabezado-ac-act">Días pagados</div>
                  <div
                    style="
                      overflow-y: auto;
                      white-space: nowrap;
                      margin: 0 auto;
                      cursor: pointer;
                      max-height: 150px;
                    "
                  >
                    <table
                      class="table table-striped rounded table-hover orden tabla-detalle tabla-detalle-pagos"
                    >
                      <thead style="position: sticky; top: 0">
                        <tr>
                          <th>Articulos de ley</th>
                          <th>Código</th>
                          <th>Descripcion</th>
                          <th>Días</th>
                          <th>Acción</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr *ngFor="let dias of detallesFSIPagados">
                          <td class="body-table" style="width: 20%">
                            <input
                              autocomplete="off"
                              type="text"
                              class="bg-[#f2f2f2] w-full border-none"
                              id="input-table"
                              [disabled]="existenEstimaciones"
                              class="bg-transparent"
                              [(ngModel)]="dias.articulosLey"
                              (keydown.enter)="crearDetalleFSI(dias)"
                              maxlength="500"
                            />
                          </td>
                          <td class="body-table" style="width: 20%">
                            <input
                              autocomplete="off"
                              type="text"
                              class="bg-[#f2f2f2] w-full border-none"
                              id="input-table"
                              [disabled]="existenEstimaciones"
                              class="bg-transparent"
                              [(ngModel)]="dias.codigo"
                              (keydown.enter)="crearDetalleFSI(dias)"
                              maxlength="50"
                            />
                          </td>
                          <td class="body-table" style="width: 50%">
                            <input
                              autocomplete="off"
                              type="text"
                              class="bg-[#f2f2f2] w-full border-none"
                              id="input-table"
                              [disabled]="existenEstimaciones"
                              class="bg-transparent"
                              [(ngModel)]="dias.descripcion"
                              (keydown.enter)="crearDetalleFSI(dias)"
                              maxlength="500"
                            />
                          </td>
                          <td class="body-table" style="width: 10%">
                            <input
                              autocomplete="off"
                              type="text"
                              class="bg-[#f2f2f2] w-full border-none"
                              id="input-table"
                              [disabled]="existenEstimaciones"
                              class="bg-transparent"
                              [(ngModel)]="dias.dias"
                              (keydown.enter)="crearDetalleFSI(dias)"
                            />
                          </td>
                          <td *ngIf="dias.id != 0 && !existenEstimaciones">
                            <button
                              class="button-filt"
                              placement="start"
                              ngbTooltip="Eliminar"
                              triggers="mouseenter:mouseleave"
                              (click)="EliminarDetFSI(dias)"
                            >
                              <img
                                src="assets/delete.svg"
                                alt="add cotizacion"
                              />
                            </button>
                          </td>
                          <td *ngIf="dias.id == 0 || existenEstimaciones"></td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                  <div class="flex w-full justify-end items-center mb-4">
                    Días pagados(DP):
                    <input
                      autocomplete="off"
                      type="text"
                      class="bg-[#f2f2f2] w-full border-none"
                      id="input-table"
                      [(ngModel)]="fsi.diasPagados"
                      readonly
                      class="bg-[#f2f2f2] text-center"
                    />
                  </div>
                </div>
                <h2>FSI = DP / (365.25 - DNLA) = {{ fsi.fsi }}</h2>

                <div
                  style="
                    overflow-x: auto;
                    white-space: nowrap;
                    width: 100%;
                    margin: 0 auto;
                    margin-top: 0px;
                  "
                >
                  <div class="style-encabezado-ac-act">
                    Obligaciones patronales
                  </div>
                  <div
                    style="
                      overflow-y: auto;
                      white-space: nowrap;
                      margin: 0 auto;
                      cursor: pointer;
                      max-height: 150px;
                    "
                  >
                    <table
                      class="table table-striped rounded table-hover orden tabla-detalle tabla-detalle-pagos"
                    >
                      <thead style="position: sticky; top: 0">
                        <tr>
                          <th>Articulos de ley</th>
                          <th>Código</th>
                          <th>Descripcion</th>
                          <th>Porcentaje</th>
                          <th>Acción</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr *ngFor="let detalle of detallesFSR">
                          <td class="body-table" style="width: 20%">
                            <input
                              autocomplete="off"
                              type="text"
                              class="bg-[#f2f2f2] w-full border-none"
                              id="input-table"
                              [disabled]="existenEstimaciones"
                              class="bg-transparent"
                              [(ngModel)]="detalle.articulosLey"
                              (keydown.enter)="crearDetalleFSR(detalle)"
                              maxlength="500"
                            />
                          </td>
                          <td class="body-table" style="width: 20%">
                            <input
                              autocomplete="off"
                              type="text"
                              class="bg-[#f2f2f2] w-full border-none"
                              id="input-table"
                              [disabled]="existenEstimaciones"
                              class="bg-transparent"
                              [(ngModel)]="detalle.codigo"
                              (keydown.enter)="crearDetalleFSR(detalle)"
                              maxlength="50"
                            />
                          </td>
                          <td class="body-table" style="width: 50%">
                            <input
                              autocomplete="off"
                              type="text"
                              class="bg-[#f2f2f2] w-full border-none"
                              id="input-table"
                              [disabled]="existenEstimaciones"
                              class="bg-transparent"
                              [(ngModel)]="detalle.descripcion"
                              (keydown.enter)="crearDetalleFSR(detalle)"
                              maxlength="500"
                            />
                          </td>
                          <td class="body-table" style="width: 10%">
                            <input
                              autocomplete="off"
                              type="number"
                              class="bg-[#f2f2f2] w-full border-none"
                              id="input-table"
                              [disabled]="existenEstimaciones"
                              class="bg-transparent"
                              [(ngModel)]="detalle.porcentajeFsr"
                              (keydown.enter)="crearDetalleFSR(detalle)"
                            />
                          </td>
                          <td *ngIf="detalle.id != 0 && !existenEstimaciones">
                            <button
                              class="button-filt"
                              placement="start"
                              ngbTooltip="Eliminar"
                              triggers="mouseenter:mouseleave"
                              (click)="EliminarDetFSR(detalle)"
                            >
                              <img
                                src="assets/delete.svg"
                                alt="add cotizacion"
                              />
                            </button>
                          </td>
                          <td
                            *ngIf="detalle.id == 0 || existenEstimaciones"
                          ></td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                  <div class="flex w-full justify-end items-center mb-4">
                    Porcentaje de obligaciones patronales (%OP):
                    <input
                      autocomplete="off"
                      type="text"
                      class="bg-[#f2f2f2] w-full border-none"
                      id="input-table"
                      [(ngModel)]="porcentajePrestaciones"
                      readonly
                      class="bg-[#f2f2f2] text-center"
                    />
                  </div>
                </div>
                <h2>FSR = FSI + %OP = {{ fsr.fsr }}</h2>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</ng-template>
