<div *ngIf="objetoRequisicion?.insumosXRequisicion?.length == 0">
  <p class="font-medium text-gray700 text-center py-2">
    No hay cotizaciones creadas.
  </p>
</div>

<section class="flex w-full mt-2" *ngIf="ExistenCotizaciones">
  <div class="overflow-x-auto rounded-lg w-[40%]">
    <table class="w-full">
      <thead class="bg-primario">
        <tr class="xs:text-[10px]">
          <th colspan="5" class="text-left text-white py-[3.5px] px-1">
            Insumos por Requisición
          </th>
        </tr>
      </thead>
      <thead class="bg-colorButton xs:h-5">
        <tr class="text-white xs:text-[10px]">
          <th class="px-1 py-[1px] font-normal">Descripción</th>
          <th class="px-[1px] py-[1px] font-normal">Unidad</th>
          <th class="px-[1px] py-[1px] font-normal">Cantidad</th>
          <th class="px-[1px] py-[1px] font-normal">P.U.Presu</th>
          <th class="px-[1px] py-[1px] font-normal">Importe</th>
        </tr>
      </thead>
      <tbody class="divide-y divide-gray300">
        <tr
          class="font-medium text-gray700 hover:bg-gray200 animation duration-200 xs:text-[8px]"
          *ngFor="let i of objetoRequisicion.insumosXRequisicion"
        >
          <td class="px-1 py-[4px] xs:py-[5px]" scope="col">
            <input
              readonly
              autocomplete="off"
              type="text"
              class="bg-transparent w-[90%]"
              [(ngModel)]="i.descripcion"
            />
          </td>
          <td class="px-1 py-[4px] xs:py-[5px]" scope="col">{{ i.unidad }}</td>
          <td class="px-1 py-[4px] xs:py-[5px] text-end" scope="col">
            {{ i.cantidad | number:'1.4-4' }}
          </td>
          <td class="px-1 py-[4px] xs:py-[5px] text-end" scope="col">
            ${{ i.precioUnitario | number:'1.2-2' }}
          </td>
          <td class="px-1 py-[4px] xs:py-[5px] text-end" scope="col">${{ i.importe | number:'1.2-2'}}</td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="flex overflow-x-auto rounded-lg w-[60%]">
    <table *ngFor="let c of objetoRequisicion.cotizacion" class="w-full">
      <thead class="bg-primario">
        <tr class="xs:text-[10px]">
          <th colspan="5" class="text-white">
            <div class="flex justify-between items-center gap-4 px-1">
              <div class="flex items-center gap-2">
                <p class="my-auto">{{ c.razonSocial }}</p>
              </div>
              <div class="flex gap-2">
                <button
                  ngbTooltip="Autorizar todo"
                  triggers="mouseenter:mouseleave"
                  (click)="Autorizar(c)"
                >
                  <img
                    src="assets/autorizar.svg"
                    width="25"
                    height="25"
                    alt="autorizar"
                  />
                </button>
                <button
                  (click)="OrdenCompra(c.idCotizacion)"
                  ngbTooltip="Ordenes de compra"
                  triggers="mouseenter:mouseleave"
                >
                  <img
                    src="assets/addorder.svg"
                    width="25"
                    height="25"
                    alt="add cotizacion"
                  />
                </button>
                <button
                  (click)="ActualizarInsumosCotizados(c)"
                  ngbTooltip="Actualizar Insumos"
                  triggers="mouseenter:mouseleave"
                >
                  <img
                    src="assets/update-alt.svg"
                    width="25"
                    height="25"
                    alt="add cotizacion"
                  />
                </button>
              </div>
            </div>
          </th>
        </tr>
      </thead>

      <thead class="bg-colorButton xs:h-5">
        <tr class="text-white xs:text-[10px]">
          <th class="px-1 py-[1px] font-normal" scope="col">Cantidad*</th>
          <th class="px-1 py-[1px] font-normal" scope="col">P. Unit.*</th>
          <th class="px-1 py-[1px] font-normal" scope="col">Importe</th>
          <th class="px-1 py-[1px] text-center font-normal" scope="col">
            Acciones
          </th>
        </tr>
      </thead>
      <tbody class="divide-y divide-gray300">
        <tr
          class="font-medium text-gray700 hover:bg-gray200 animation duration-200 xs:text-[8px]"
          *ngFor="let ic of c.insumoXCotizacion"
        >
          <td scope="col" [ngClass]="{ estilo2: ic.estatus > 1 }" *ngIf="ic.estatus <= 1" >
            <input
              type="number"
              [(ngModel)]="ic.cantidad"
              class="bg-transparent text-end"
              [ngClass]="{ estilo2: ic.estatus > 1 }"
              [disabled]="ic.estatus > 1"
              (keydown.enter)="ActualizarInsumoCotizado(ic)"
            />
          </td>
          <td class="text-end" scope="col" [ngClass]="{ estilo2: ic.estatus > 1 }" *ngIf="ic.estatus > 1">
            ${{ic.cantidad | number:'1.4-4'}}
          </td>
          <td scope="col" [ngClass]="{ estilo2: ic.estatus > 1 }" *ngIf="ic.estatus <= 1">
            <input
              type="number"
              [(ngModel)]="ic.precioUnitario"
              class="bg-transparent text-end"
              [ngClass]="{ estilo2: ic.estatus > 1 }"
              [disabled]="ic.estatus > 1"
              (keydown.enter)="ActualizarInsumoCotizado(ic)"
            />
          </td>
          <td scope="col" [ngClass]="{ estilo2: ic.estatus > 1 }" *ngIf="ic.estatus > 1" class="text-end">
            ${{ic.precioUnitario | number:'1.2-2'}}
          </td>
          <td
            scope="col"
            [ngClass]="{ estilo2: ic.estatus > 1 }"
            (click)="VerImpuestos(ic)"
            class="text-end"
          >
            ${{ ic.importe | number:'1.2-2' }}
          </td>
          <td
            class="text-center"
            scope="col"
            [ngClass]="{ estilo2: ic.estatus > 1 }"
          >
            <button
              class="bg-[#4EAAC1] border-none text-[#f2f2f2f2] rounded-sm p-1 m-[0.7px]"
              ngbTooltip="Autorizar Cotización"
              triggers="mouseenter:mouseleave"
              (click)="AutorizarInusmo(ic)"
            >
              <img
                src="assets/autorizar.svg"
                width="15"
                height="15"
                alt="autorizar"
              />
            </button>
            <!-- <button class="bg-[#4EAAC1]  border-none text-[#f2f2f2f2] rounded-sm p-1 m-[0.7px] " placement="top"
              ngbTooltip="Actualizar Cotización" triggers="mouseenter:mouseleave"
              (click)="ActualizarInsumoCotizado(ic)">
              <img src="assets/update-alt.svg" width="15" height="15" alt="autorizar">
            </button> -->
            <!-- <button class="bg-[#4EAAC1]  border-none text-[#f2f2f2f2] rounded-sm p-1 m-[0.7px] " placement="top"
              ngbTooltip="Impuestos" triggers="mouseenter:mouseleave" (click)="VerImpuestos(ic)">
              <img src="assets/cash-svgrepo.svg" width="15" height="15" alt="autorizar">
            </button> -->
            <button
              class="bg-[#4EAAC1] border-none text-[#f2f2f2f2] rounded-sm p-1 m-[0.7px]"
              ngbTooltip="Remover Autorizacion"
              triggers="mouseenter:mouseleave"
              (click)="RemoverAutorizacionInsumo(ic)"
            >
              <img
                src="assets/remove-user.svg"
                width="15"
                height="15"
                alt="autorizar"
              />
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</section>

<!-- Panel de Captura -->
<ng-template #dialogImpuestos>
  <div
    class="fixed inset-0 z-10 w-screen overflow-y-auto"
    (click)="limpiarFormularioNuevaEntrada()"
  >
    <div
      class="content-center sm:flex min-h-full items-cen justify-center p-4 text-center sm:items-center sm:p-0"
    >
      <!-- Evita que el clic se propague al contenedor padre (overlay) -->

      <div
        class="relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-4xl"
        (click)="detenerCierre($event)"
      >
        <!-- detenerCierre(event: MouseEvent): Método que detiene la propagación del evento de clic cuando se hace clic dentro del contenido del modal, asegurando que el modal no se cierre inadvertidamente. -->
        <div class="m-2 flex justify-between">
          <h2 class="font-normal tracking-[2px] leading-8 text-base">
            Impuestos
          </h2>
          <button
            type="button"
            class="leading-none absolute top-0 right-0 px-4 py-3 text-2xl"
            (click)="limpiarFormularioNuevaEntrada()"
          >
            &times;
          </button>
        </div>
        <div class="bg-white px-4 pb-4 sm:p-2 sm:pb-4">
          <div>
            <div
              style="
                overflow-x: auto;
                white-space: nowrap;
                width: 100%;
                margin: 0 auto;
                margin-top: 0px;
                margin-top: 15px;
              "
            >
              <table
                class="table table-striped rounded table-hover orden tabla-detalle tabla-detalle-pagos"
              >
                <thead>
                  <tr>
                    <th class="cabecera1" scope="col">Tipo de Impuesto</th>
                    <th class="cabecera1" scope="col">Procentaje</th>
                    <th class="cabecera1" scope="col">Acion</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let iic of impuestoInsumoCotizado">
                    <td class="" scope="col">
                      <select
                        [(ngModel)]="iic.idImpuesto"
                        [disabled]="iic.id > 0"
                        (change)="selectOpt($event, iic)"
                        class="bg-transparent"
                      >
                        <option
                          *ngFor="let imp of impuestos"
                          [ngValue]="imp.id"
                        >
                          {{ imp.descripcionImpuesto }}
                        </option>
                      </select>
                    </td>
                    <td class="" scope="col">
                      <input
                        autocomplete="off"
                        class="form-contrtrol dropdown1 bg-transparent"
                        type="number"
                        style="margin: 5px"
                        [(ngModel)]="iic.porcentaje"
                        (keydown.enter)="agregarNuevoImpuesto()"
                      />
                    </td>
                    <td class="" scope="col">
                      <button
                        class="button-filt"
                        placement="end"
                        ngbTooltip="Eliminar"
                        triggers="mouseenter:mouseleave"
                        (click)="EliminarImpuesto(iic)"
                      >
                        <img src="assets/delete.svg" alt="add cotizacion" />
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</ng-template>

<div *ngIf="seleccionParaOrdenComrpa">
  <div class="flex justify-end mt-2">
    <button
      type="button"
      class="leading-none top-0 right-0 px-2 text-2xl"
      (click)="regresar('cotizacion')"
    >
      &times;
    </button>
  </div>

  <app-orden-compra
    (enviarAlerta)="lanzarAlerta($event.tipo, $event.mensaje)"
    *appRecarga="appRecarga"
    [idCotizacionInput]="idCotizacionParaOC"
  >
  </app-orden-compra>
</div>
