<p class="text-center font-semibold text-lg xs:text-sm">Ordenes de compra</p>
<div>
  <button
    (click)="crearOrdenCompra()"
    class="flex align-items-center rounded-md bg-colorButton transition-colors delay-75 hover:bg-colorButtonHover font-light text-white p-1"
  >
    <p
      class="text-[#f2f2f2] titular bg-custom-bg w-52 font-medium text-base tracking-wider m-0 text-center xs:text-[10px] xs:w-32"
    >
      Nueva orden de compra
    </p>
    <img class="xs:w-4" src="assets/add.svg" alt="botón agregar" />
  </button>
</div>

<!-- Orden de compra -->
<div class="p-[5px] bg-transparent">
  <div class="rounded-lg shadow-md overflow-hidden">
    <div class="overflow-x-auto">
      <table class="w-full text-sm text-left">
        <thead class="bg-primario text-white">
          <tr class="xs:text-[10px]">
            <th
              scope="col"
              class="px-1 py-[2px] xs:w-[20px] md:hidden lg:hidden"
            ></th>
            <th class="px-1 py-[1px]" scope="col">No.Orden</th>
            <th class="px-[2px] py-[1px] xs:hidden" scope="col">Registro</th>
            <th class="px-[2px] py-[1px] text-center xs:hidden" scope="col">
              Estatus
            </th>
            <th class="px-[2px] py-[1px] text-center xs:hidden" scope="col">
              Insumos Surtidos
            </th>
            <th class="px-[2px] py-[1px]" scope="col">Chofer*</th>
            <th class="px-[2px] py-[1px]" scope="col">Observaciones*</th>
            <th class="px-[2px] py-[1px] text-center" scope="col">Insumos</th>

            <!-- <th class="cabecera1" scope="col">Acciones</th> -->
          </tr>
        </thead>
        <tbody class="divide-y divide-gray300">
          <tr
            class="font-medium text-gray700 hover:bg-gray200 animation duration-200 xs:text-[8px]"
            scope="col"
            *ngIf="ordenescompras.length == 0"
          >
            <td colspan="7" class="text-center">No hay ordenes de compra.</td>
          </tr>
          <ng-container *ngFor="let ordenCompra of ordenescompras">
            <tr
              class="font-medium text-gray700 hover:bg-gray200 animation duration-200 xs:text-[8px]"
              [ngClass]="{
                'change-background-color': ordenCompra.id == idOrdenCompra
              }"
            >
              <td class="md:hidden lg:hidden" scope="col">
                <img
                  (click)="desplegarInformacion({ordenCompra})"
                  *ngIf="ordenCompra.isExpanded"
                  src="../../../../assets/arrow_down.svg"
                  alt="insumoCotizacionono de abrir"
                />
                <img
                  (click)="desplegarInformacion({ordenCompra})"
                  *ngIf="!ordenCompra.isExpanded"
                  src="../../../../assets/arrow_right.svg"
                  alt="insumoCotizacionono de cerrar"
                />
              </td>
              <td scope="col" class="px-1 py-[2px]">
                <input
                  readonly
                  autocomplete="off"
                  type="text"
                  class="bg-transparent w-[80%]"
                  [(ngModel)]="ordenCompra.noOrdenCompra"
                />
              </td>
              <td scope="col" class="px-1 py-[2px] min-w-2 xs:hidden">
                {{ ordenCompra.fechaRegistro | date : "dd-MM-yyyy" }}
              </td>
              <td scope="col" class="px-1 py-[2px] xs:hidden">
                <div class="flex justify-center h-full">
                  <div
                    class="bg-blue100 rounded-lg w-28 h-5"
                    *ngIf="ordenCompra.estatus === 1"
                  >
                    <p class="text-blue600 text-center">Capturada</p>
                  </div>
                  <div class="bg-amber100 rounded-lg w-28 h-5" *ngElse>
                    <p class="text-amber600 text-center">No disponible</p>
                  </div>
                </div>
              </td>
              <td scope="col" class="px-1 py-[2px] xs:hidden">
                <div class="flex justify-center h-full">
                  <div
                    class="bg-amber50 rounded-lg w-28 h-5"
                    *ngIf="
                      ordenCompra.estatusInsumosSurtidosDescripcion ===
                      'Pendiente'
                    "
                  >
                    <p class="text-amber500 text-center">Pendiente</p>
                  </div>
                  <div
                    class="bg-blue100 rounded-lg w-48 h-5"
                    *ngIf="
                      ordenCompra.estatusInsumosSurtidosDescripcion ===
                      'Surtida parcialmente'
                    "
                  >
                    <p class="text-blue600 text-center">Surtido parcialmente</p>
                  </div>
                  <div
                    class="bg-green100 rounded-lg w-48 h-5"
                    *ngIf="
                      ordenCompra.estatusInsumosSurtidosDescripcion ===
                      'Surtida totalmente'
                    "
                  >
                    <p class="text-green600 text-center">Surtido totalmente</p>
                  </div>
                </div>
              </td>
              <td scope="col" class="px-1 py-[2px]">
                <input
                  placeholder="Chofer..."
                  autocomplete="off"
                  class="bg-transparent w-[70%]"
                  type="text"
                  data-bs-toggle="dropdown"
                  [(ngModel)]="ordenCompra.chofer"
                  (keydown.enter)="actualizarOrdenCompra(ordenCompra)"
                />
              </td>
              <td scope="col" class="px-1 py-[2px]">
                <input
                  placeholder="Observaciones..."
                  autocomplete="off"
                  class="bg-transparent"
                  type="text"
                  data-bs-toggle="dropdown"
                  [(ngModel)]="ordenCompra.observaciones"
                  (keydown.enter)="actualizarOrdenCompra(ordenCompra)"
                />
              </td>
              <td scope="col" class="px-1 py-[1px]">
                <div *ngIf="!insumosEstado">
                  <img
                    ngbTooltip="Ver insumos"
                    triggers="mouseenter:mouseleave"
                    class="cursor-pointer mx-auto xs:w-4"
                    src="../../../../assets/visibility_btn.svg"
                    alt="ver insumos"
                    (click)="OrdenCompraSeleccionada(ordenCompra.id)"
                  />
                </div>
                <div *ngIf="insumosEstado">
                  <img
                    ngbTooltip="Cerrar insumos"
                    triggers="mouseenter:mouseleave"
                    class="cursor-pointer mx-auto xs:w-4"
                    src="../../../../assets/visibility-off_btn.svg"
                    alt="ver insumos"
                    (click)="cerrarOrdenCompra()"
                  />
                </div>
              </td>
              <!-- <td scope="col">
            <button class="button-filt" placement="top" ngbTooltip="Autorizar Cotización" triggers="mouseenter:mouseleave"
            (click)="VerEntradasAlmacen(oc.id)">Ver Entradas de Almacen
          </button>
        </td> -->
            </tr>
            <tr
              class="font-medium text-gray700 hover:bg-gray200 animation duration-200 xs:text-[8px]"
              *ngIf="ordenCompra.isExpanded"
            >
              <td class="px-1 py-[2px]" colspan="5">
                <div class="flex gap-1">
                  <label class="font-bold">Fecha de registro:</label>
                  {{ ordenCompra.fechaRegistro | date : "dd-MM-yyyy" }}
                </div>
              </td>
            </tr>
            <tr
              class="font-medium text-gray700 hover:bg-gray200 animation duration-200 xs:text-[8px]"
              *ngIf="ordenCompra.isExpanded"
            >
              <td class="px-1 py-[2px]" colspan="5">
                <div class="flex gap-1">
                  <label class="font-bold">Estatus:</label>
                  <div class="flex justify-center h-full">
                    <div
                      class="bg-blue100 rounded-lg w-28 h-5"
                      *ngIf="ordenCompra.estatus === 1"
                    >
                      <p class="text-blue600 text-center">Capturada</p>
                    </div>
                    <div class="bg-amber100 rounded-lg w-28 h-5" *ngElse>
                      <p class="text-amber600 text-center">No disponible</p>
                    </div>
                  </div>
                </div>
              </td>
            </tr>
            <tr
              class="font-medium text-gray700 hover:bg-gray200 animation duration-200 xs:text-[8px]"
              *ngIf="ordenCompra.isExpanded"
            >
              <td class="px-1 py-[2px]" colspan="5">
                <div class="flex gap-1">
                  <label class="font-bold">Insumos surtidos:</label>
                  <div class="flex justify-center h-full">
                    <div
                      class="bg-amber50 rounded-lg w-28 h-5 xs:w-18"
                      *ngIf="
                        ordenCompra.estatusInsumosSurtidosDescripcion ===
                        'Pendiente'
                      "
                    >
                      <p class="text-amber500 text-center">Pendiente</p>
                    </div>
                    <div
                      class="bg-blue100 rounded-lg w-48 h-5 xs:w-24"
                      *ngIf="
                        ordenCompra.estatusInsumosSurtidosDescripcion ===
                        'Surtida parcialmente'
                      "
                    >
                      <p class="text-blue600 text-center xs:w-24">
                        Surtido parcialmente
                      </p>
                    </div>
                    <div
                      class="bg-green100 rounded-lg w-48 h-5"
                      *ngIf="
                        ordenCompra.estatusInsumosSurtidosDescripcion ===
                        'Surtida totalmente'
                      "
                    >
                      <p class="text-green600 text-center">
                        Surtido totalmente
                      </p>
                    </div>
                  </div>
                </div>
              </td>
            </tr>
          </ng-container>
        </tbody>
      </table>
    </div>
  </div>
</div>
<!-- Orden de compra end-->

<!-- Insumos por comprar -->
<div *ngIf="idOrdenCompra > 0 && listaInsumosXCotizacion.length > 0">
  <p class="text-center font-semibold text-lg mt-2 xs:text-sm">
    Insumos por comprar
  </p>
  <div class="p-[5px] bg-transparent">
    <div class="rounded-lg shadow-md overflow-hidden">
      <div class="overflow-x-auto">
        <table class="w-full text-sm text-left">
          <thead class="bg-primario text-white">
            <tr class="xs:text-[10px]">
              <th class="px-1 py-[1px] md:hidden lg:hidden" scope="col"></th>
              <th class="px-1 py-[1px]" scope="col">No.Cotización</th>
              <th class="px-[2px] py-[1px]" scope="col">Descripción</th>
              <th class="px-[2px] py-[1px]" scope="col">Unidad</th>
              <th class="px-[2px] py-[1px]" scope="col">Cantidad</th>
              <th class="px-[2px] py-[1px] xs:hidden" scope="col">
                Precio Unitario
              </th>
              <th class="px-[2px] py-[1px] xs:hidden" scope="col">Con IVA</th>
              <th class="px-[2px] py-[1px] xs:hidden" scope="col">Sin IVA</th>
              <th class="px-[2px] py-[1px] text-center" scope="col">Comprar</th>
            </tr>
          </thead>

          <tbody class="divide-y divide-gray300">
            <ng-container
              *ngFor="let insumoCotizacion of listaInsumosXCotizacion"
            >
              <tr
                class="font-medium text-gray700 hover:bg-gray200 animation duration-200 xs:text-[8px]"
              >
                <td class="md:hidden lg:hidden" scope="col">
                  <img
                    (click)="desplegarInformacion({insumoCotizacion})"
                    *ngIf="insumoCotizacion.isExpanded"
                    src="../../../../assets/arrow_down.svg"
                    alt="abrir"
                  />
                  <img
                    (click)="desplegarInformacion({insumoCotizacion})"
                    *ngIf="!insumoCotizacion.isExpanded"
                    src="../../../../assets/arrow_right.svg"
                    alt="cerrar"
                  />
                </td>
                <td class="px-1 py-[2px]" scope="col">
                  <input
                    readonly
                    autocomplete="off"
                    type="text"
                    class="bg-transparent w-[90%]"
                    [(ngModel)]="insumoCotizacion.noCotizacion"
                  />
                </td>
                <td class="px-1 py-[2px]" scope="col">
                  <input
                    readonly
                    autocomplete="off"
                    type="text"
                    class="bg-transparent w-[90%]"
                    [(ngModel)]="insumoCotizacion.descripcion"
                  />
                </td>
                <td class="px-1 py-[2px]" scope="col">
                  {{ insumoCotizacion.unidadCotizada }}
                </td>
                <td class="px-1 py-[2px]" scope="col">
                  {{ insumoCotizacion.cantidadCotizada }}
                </td>
                <td class="px-1 py-[2px] xs:hidden" scope="col">
                  {{ insumoCotizacion.precioUnitario }}
                </td>
                <td class="px-1 py-[2px] xs:hidden" scope="col">
                  {{ insumoCotizacion.importeSinIva }}
                </td>
                <td class="px-1 py-[2px] xs:hidden" scope="col">
                  {{ insumoCotizacion.importeTotal }}
                </td>
                <td scope="col">
                  <img
                    (click)="ComprarInsumo(insumoCotizacion)"
                    ngbTooltip="Comprar"
                    triggers="mouseenter:mouseleave"
                    class="mx-auto cursor-pointer xs:w-4"
                    src="../../../../assets/buy.svg"
                  />
                </td>
              </tr>

              <tr
                class="font-medium text-gray700 hover:bg-gray200 animation duration-200 xs:text-[8px]"
                *ngIf="insumoCotizacion.isExpanded"
              >
                <td class="px-1 py-[2px] min-w-2" scope="col" colspan="7">
                  <div class="flex gap-1">
                    <label class="font-bold">Precio Unitario:</label>
                    {{ insumoCotizacion.precioUnitario }}
                  </div>
                </td>
              </tr>
              <tr
                class="font-medium text-gray700 hover:bg-gray200 animation duration-200 xs:text-[8px]"
                *ngIf="insumoCotizacion.isExpanded"
              >
                <td class="px-1 py-[2px] min-w-2" scope="col" colspan="7">
                  <div class="flex gap-1">
                    <label class="font-bold">Importe Sin IVA:</label>
                    {{ insumoCotizacion.importeSinIva }}
                  </div>
                </td>
              </tr>
              <tr
                class="font-medium text-gray700 hover:bg-gray200 animation duration-200 xs:text-[8px]"
                *ngIf="insumoCotizacion.isExpanded"
              >
                <td class="px-1 py-[2px] min-w-2" scope="col" colspan="7">
                  <div class="flex gap-1">
                    <label class="font-bold">Importe Con IVA:</label>

                    {{ insumoCotizacion.importeTotal }}
                  </div>
                </td>
              </tr>
            </ng-container>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
<!-- Insumos por comprar end-->

<!-- Insumos comprados-->
<div *ngIf="idOrdenCompra > 0">
  <p class="text-center font-semibold text-lg mt-2 xs:text-sm">
    Insumos comprados
  </p>

  <div class="p-[5px] bg-transparent">
    <div class="rounded-lg shadow-md overflow-hidden">
      <div class="overflow-x-auto">
        <table class="w-full text-sm text-left">
          <thead class="bg-primario text-white">
            <tr class="xs:text-[10px]">
              <th class="px-1 py-[2px] md:hidden lg:hidden" scope="col"></th>
              <th class="px-1 py-[2px]" scope="col">Descripción</th>
              <th class="px-[2px] py-[2px]" scope="col">Unidad</th>
              <th class="px-[2px] py-[2px]" scope="col">Cantidad</th>
              <th class="px-[2px] py-[2px] xs:hidden" scope="col">P.U.</th>
              <th class="px-[2px] py-[2px] xs:hidden" scope="col">Sin IVA</th>
              <th class="px-[2px] py-[2px] xs:hidden" scope="col">Con IVA</th>
              <th class="px-[2px] py-[2px] text-center xs:hidden" scope="col">
                Estatus
              </th>
            </tr>
          </thead>
          <tbody class="divide-y divide-gray300">
            <tr
              class="font-medium text-gray700 hover:bg-gray200 animation duration-200 xs:text-[8px]"
              *ngIf="insumosXordencompras.length == 0"
            >
              <td colspan="10" class="text-center">
                No hay insumos comprados.
              </td>
            </tr>
            <ng-container *ngFor="let insumoOc of insumosXordencompras">
              <tr
                class="font-medium text-gray700 hover:bg-gray200 animation duration-200 xs:text-[8px]"
              >
                <td class="md:hidden lg:hidden" scope="col">
                  <img
                    (click)="desplegarInformacion({insumoOc})"
                    *ngIf="insumoOc.isExpanded"
                    src="../../../../assets/arrow_down.svg"
                    alt="insumoCotizacionono de abrir"
                  />
                  <img
                    (click)="desplegarInformacion({insumoOc})"
                    *ngIf="!insumoOc.isExpanded"
                    src="../../../../assets/arrow_right.svg"
                    alt="insumoCotizacionono de cerrar"
                  />
                </td>
                <td class="px-1 py-[2px]" scope="col">
                  <input
                    readonly
                    autocomplete="off"
                    type="text"
                    class="bg-transparent w-[90%]"
                    [(ngModel)]="insumoOc.descripcion"
                  />
                </td>
                <td class="px-1 py-[2px]" scope="col">
                  {{ insumoOc.unidad }}
                </td>
                <td class="px-1 py-[2px]" scope="col">
                  {{ insumoOc.cantidad }}
                </td>
                <td class="px-1 py-[2px] xs:hidden" scope="col">
                  {{ insumoOc.precioUnitario }}
                </td>
                <td class="px-1 py-[2px] xs:hidden" scope="col">
                  {{ insumoOc.importeSinIva }}
                </td>
                <td
                  class="px-1 py-[2px] xs:hidden cursor-pointer"
                  scope="col"
                  (click)="verImpuestos(insumoOc.id)"
                >
                  {{ insumoOc.importeConIva }}
                </td>
                <td class="px-1 py-[2px] xs:hidden" scope="col">
                  <!-- {{ ioc.estatusInsumoOrdenCompraDescripcion }} -->
                  <div class="flex justify-center h-full">
                    <div
                      class="bg-amber50 rounded-lg w-28 h-5"
                      *ngIf="
                        insumoOc.estatusInsumoOrdenCompraDescripcion ===
                        'Pendiente'
                      "
                    >
                      <p class="text-amber500 text-center">Pendiente</p>
                    </div>
                    <div
                      class="bg-blue100 rounded-lg w-48 h-5"
                      *ngIf="
                        insumoOc.estatusInsumoOrdenCompraDescripcion ===
                        'Surtida parcialmente'
                      "
                    >
                      <p class="text-blue600 text-center">
                        Surtido parcialmente
                      </p>
                    </div>
                    <div
                      class="bg-green100 rounded-lg w-48 h-5"
                      *ngIf="
                        insumoOc.estatusInsumoOrdenCompraDescripcion ===
                        'Surtida totalmente'
                      "
                    >
                      <p class="text-green600 text-center">
                        Surtido totalmente
                      </p>
                    </div>
                  </div>
                </td>
              </tr>
              <tr
                class="font-medium text-gray700 hover:bg-gray200 animation duration-200 xs:text-[8px]"
                *ngIf="insumoOc.isExpanded"
              >
                <td class="px-1 py-[2px]" scope="col" colspan="4">
                  <div class="flex gap-1">
                    <label class="font-bold">Precio Unitario:</label>
                    {{ insumoOc.precioUnitario }}
                  </div>
                </td>
              </tr>
              <tr
                class="font-medium text-gray700 hover:bg-gray200 animation duration-200 xs:text-[8px]"
                *ngIf="insumoOc.isExpanded"
              >
                <td class="px-1 py-[2px]" scope="col" colspan="4">
                  <div class="flex gap-1">
                    <label class="font-bold">Importe Sin IVA:</label>
                    {{ insumoOc.importeSinIva }}
                  </div>
                </td>
              </tr>
              <tr
                class="font-medium text-gray700 hover:bg-gray200 animation duration-200 xs:text-[8px]"
                *ngIf="insumoOc.isExpanded"
              >
                <td
                  class="px-1 py-[2px]"
                  scope="col"
                  (click)="verImpuestos(insumoOc.id)"
                  colspan="4"
                >
                  <div>
                    <label class="font-bold">Importe Con IVA:</label>

                    {{ insumoOc.importeConIva }}
                  </div>
                </td>
              </tr>
              <tr
                class="font-medium text-gray700 hover:bg-gray200 animation duration-200 xs:text-[8px]"
                *ngIf="insumoOc.isExpanded"
              >
                <td class="px-1 py-[2px]" scope="col" colspan="4">
                  <div class="flex gap-1">
                    <label class="font-bold">Estatus:</label>
                    <!-- {{ ioc.estatusInsumoOrdenCompraDescripcion }} -->
                    <div class="flex justify-center h-full">
                      <div
                        class="bg-amber50 rounded-lg w-28 h-5"
                        *ngIf="
                          insumoOc.estatusInsumoOrdenCompraDescripcion ===
                          'Pendiente'
                        "
                      >
                        <p class="text-amber500 text-center">Pendiente</p>
                      </div>
                      <div
                        class="bg-blue100 rounded-lg w-48 h-5"
                        *ngIf="
                          insumoOc.estatusInsumoOrdenCompraDescripcion ===
                          'Surtida parcialmente'
                        "
                      >
                        <p class="text-blue600 text-center">
                          Surtido parcialmente
                        </p>
                      </div>
                      <div
                        class="bg-green100 rounded-lg w-48 h-5"
                        *ngIf="
                          insumoOc.estatusInsumoOrdenCompraDescripcion ===
                          'Surtida totalmente'
                        "
                      >
                        <p class="text-green600 text-center">
                          Surtido totalmente
                        </p>
                      </div>
                    </div>
                  </div>
                </td>
              </tr>
            </ng-container>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
<!-- Insumos comprados end-->
