<section>
  <div>
    <div>
      <app-alert
        *ngIf="alertaTipo !== AlertaTipo.none"
        [alertaTipo]="alertaTipo"
        [alertaMessage]="alertaMessage"
        (close)="cerrarAlerta()"
      >
      </app-alert>
      <!-- Button cotainer -->
      <div class="flex mt-1 mb-2" *ngIf="proyectoSeleccionado && !veiewInsumos">
        <button
          (click)="crearRequisicion()"
          class="flex align-items-center rounded-md bg-colorButton transition-colors delay-75 hover:bg-colorButtonHover font-light text-white p-1"
        >
          <p
            class="text-[#f2f2f2] titular bg-custom-bg w-52 font-medium text-base tracking-wider m-0 text-center xs:text-[10px] xs:w-24"
          >
            Nueva requisición
          </p>
          <img class="xs:w-4" src="assets/add.svg" alt="botón agregar" />
        </button>
      </div>
      <div class="flex mt-1 mb-2" *ngIf="veiewInsumos">
        <button
          (click)="regresarARequisiciones()"
          class="text-left text-sm hover:bg-gray-200 rounded-md transition-all delay-75 flex gap-2 items-center font-medium text-gray700 px-2"
        >
          <img class="w-8" src="assets/go_back.svg" alt="Regresar" />
            Compras
        </button>
      </div>
      <!-- Button cotainer  end -->

      <p class="text-sm font-medium mb-2 text-gray700 xs:text-[10px]">
        Campos obligatorios marcados con <span class="font-bold">*</span>
      </p>
    </div>

    <!-- Table -->
    <div class="overflow-x-auto shadow-md rounded-lg">
      <!-- Table container -->
      <div>
        <table class="w-full text-sm xs:table-fixed">
          <thead class="bg-primario text-white">
            <tr class="xs:text-[10px]">
              <th scope="col" class="px-1 py-[2px] xs:w-[75px]">Requisición</th>
              <th scope="col" class="px-[2px] py-[2px] xs:w-[70px]">Elaboró</th>
              <th scope="col" class="px-[2px] py-[2px] xs:w-[75px]">
                Registro
              </th>
              <th scope="col" class="px-[2px] py-[2px] text-center xs:hidden">
                Estatus
              </th>
              <th scope="col" class="px-[2px] py-[2px] xs:hidden">*Solicita</th>
              <th scope="col" class="px-[2px] py-[2px] xs:hidden">
                *Descripción
              </th>
              <th scope="col" class="px-[2px] py-[2px] text-center xs:w-[75px]">
                Acciones
              </th>
            </tr>
          </thead>
          <tbody class="divide-y divide-gray300">
            <ng-container *ngIf="isLoading">
              <tr>
                <!-- Requisición -->
                <td class="px-1" scope="col">
                  <div role="status" class="max-w-sm animate-pulse">
                    <div
                      class="h-5 bg-gray300 rounded-full w-40 xs:w-14 xs:h-3 mt-1 mb-1"
                    ></div>
                  </div>
                </td>
                <!-- Elaboró -->
                <td scope="col">
                  <div role="status" class="max-w-sm animate-pulse">
                    <div
                      class="h-5 bg-gray300 rounded-full w-28 xs:w-14 xs:h-3 mt-1 mb-1"
                    ></div>
                  </div>
                </td>
                <!-- Registro -->
                <td scope="col">
                  <div role="status" class="max-w-sm animate-pulse">
                    <div
                      class="h-5 bg-gray300 rounded-full w-28 xs:w-14 xs:h-3 mt-1 mb-1"
                    ></div>
                  </div>
                </td>
                <!-- Estatus -->
                <td class="px-1 flex justify-center" scope="col">
                  <div role="status" class="max-w-sm animate-pulse">
                    <div
                      class="h-5 bg-gray300 rounded-full w-32 xs:w-16 xs:h-3 mt-1 mb-1"
                    ></div>
                  </div>
                </td>
                <!-- solicita -->
                <td class="xs:hidden" scope="col">
                  <div role="status" class="max-w-sm animate-pulse">
                    <div
                      class="h-5 bg-gray300 rounded-full w-52 mt-1 mb-1"
                    ></div>
                  </div>
                </td>
                <!-- Descripción -->
                <td class="xs:hidden" scope="col">
                  <div role="status" class="max-w-sm animate-pulse">
                    <div
                      class="h-5 bg-gray300 rounded-full w-52 mt-1 mb-1"
                    ></div>
                  </div>
                </td>
                <!-- Insumos -->
                <td class="flex justify-center xs:hidden" scope="col">
                  <div role="status" class="max-w-sm animate-pulse">
                    <div
                      class="h-5 bg-gray300 rounded-full w-52 mt-1 mb-1"
                    ></div>
                  </div>
                </td>
              </tr>
              <tr>
                <!-- Requisición -->
                <td class="px-1" scope="col">
                  <div role="status" class="max-w-sm animate-pulse">
                    <div
                      class="h-5 bg-gray300 rounded-full w-40 xs:w-14 xs:h-3 mt-1 mb-1"
                    ></div>
                  </div>
                </td>
                <!-- Elaboró -->
                <td scope="col">
                  <div role="status" class="max-w-sm animate-pulse">
                    <div
                      class="h-5 bg-gray300 rounded-full w-28 xs:w-14 xs:h-3 mt-1 mb-1"
                    ></div>
                  </div>
                </td>
                <!-- Registro -->
                <td scope="col">
                  <div role="status" class="max-w-sm animate-pulse">
                    <div
                      class="h-5 bg-gray300 rounded-full w-28 xs:w-14 xs:h-3 mt-1 mb-1"
                    ></div>
                  </div>
                </td>
                <!-- Estatus -->
                <td class="px-1 flex justify-center" scope="col">
                  <div role="status" class="max-w-sm animate-pulse">
                    <div
                      class="h-5 bg-gray300 rounded-full w-32 xs:w-16 xs:h-3 mt-1 mb-1"
                    ></div>
                  </div>
                </td>
                <!-- solicita -->
                <td class="xs:hidden" scope="col">
                  <div role="status" class="max-w-sm animate-pulse">
                    <div
                      class="h-5 bg-gray300 rounded-full w-52 mt-1 mb-1"
                    ></div>
                  </div>
                </td>
                <!-- Descripción -->
                <td class="xs:hidden" scope="col">
                  <div role="status" class="max-w-sm animate-pulse">
                    <div
                      class="h-5 bg-gray300 rounded-full w-52 mt-1 mb-1"
                    ></div>
                  </div>
                </td>
                <!-- Insumos -->
                <td class="flex justify-center xs:hidden" scope="col">
                  <div role="status" class="max-w-sm animate-pulse">
                    <div
                      class="h-5 bg-gray300 rounded-full w-52 mt-1 mb-1"
                    ></div>
                  </div>
                </td>
              </tr>
              <tr>
                <!-- Requisición -->
                <td class="px-1" scope="col">
                  <div role="status" class="max-w-sm animate-pulse">
                    <div
                      class="h-5 bg-gray300 rounded-full w-40 xs:w-14 xs:h-3 mt-1 mb-1"
                    ></div>
                  </div>
                </td>
                <!-- Elaboró -->
                <td scope="col">
                  <div role="status" class="max-w-sm animate-pulse">
                    <div
                      class="h-5 bg-gray300 rounded-full w-28 xs:w-14 xs:h-3 mt-1 mb-1"
                    ></div>
                  </div>
                </td>
                <!-- Registro -->
                <td scope="col">
                  <div role="status" class="max-w-sm animate-pulse">
                    <div
                      class="h-5 bg-gray300 rounded-full w-28 xs:w-14 xs:h-3 mt-1 mb-1"
                    ></div>
                  </div>
                </td>
                <!-- Estatus -->
                <td class="px-1 flex justify-center" scope="col">
                  <div role="status" class="max-w-sm animate-pulse">
                    <div
                      class="h-5 bg-gray300 rounded-full w-32 xs:w-16 xs:h-3 mt-1 mb-1"
                    ></div>
                  </div>
                </td>
                <!-- solicita -->
                <td class="xs:hidden" scope="col">
                  <div role="status" class="max-w-sm animate-pulse">
                    <div
                      class="h-5 bg-gray300 rounded-full w-52 mt-1 mb-1"
                    ></div>
                  </div>
                </td>
                <!-- Descripción -->
                <td class="xs:hidden" scope="col">
                  <div role="status" class="max-w-sm animate-pulse">
                    <div
                      class="h-5 bg-gray300 rounded-full w-52 mt-1 mb-1"
                    ></div>
                  </div>
                </td>
                <!-- Insumos -->
                <td class="flex justify-center xs:hidden" scope="col">
                  <div role="status" class="max-w-sm animate-pulse">
                    <div
                      class="h-5 bg-gray300 rounded-full w-52 mt-1 mb-1"
                    ></div>
                  </div>
                </td>
              </tr>
            </ng-container>

            <ng-container *ngIf="!isLoading">
              <tr
                *ngIf="paginatedRequisicion.length == 0"
                class="lg:hidden md:hidden xl:hidden"
              >
                <td
                  colspan="4"
                  class="text-center text-gray-700 font-medium py-1 xs:text-xs"
                >
                  No hay requisiciones creadas.
                </td>
              </tr>
              <tr *ngIf="paginatedRequisicion.length == 0" class="xs:hidden">
                <td
                  colspan="6"
                  class="text-center text-gray-700 font-medium py-1 xs:text-xs"
                >
                  No hay requisiciones creadas.
                </td>
              </tr>
              <tr
                class="font-medium text-gray700 hover:bg-gray200 animation duration-200 xs:text-[8px]"
                *ngFor="let r of paginatedRequisicion"
                [ngClass]="{ 'change-background-color': r.id === changeColor }"
              >
                <td class="px-1 py-[2px]" scope="col">
                  {{ r.noRequisicion }}
                </td>
                <td class="px-1 py-[2px]" scope="col">
                  {{ r.personaSolicitante }}
                </td>
                <td class="px-1 py-[2px]" scope="col">
                  {{ r.fechaRegistro | date : "dd-MM-yyyy" }}
                </td>
                <td class="px-1 py-[2px] xs:hidden" scope="col">
                  <div class="flex justify-center h-full">
                    <div
                      class="bg-blue100 rounded-lg w-28 h-5"
                      *ngIf="r.estatusRequisicion === 1"
                    >
                      <p class="text-blue600 text-center">Capturada</p>
                    </div>
                    <div class="bg-amber100 rounded-lg w-28 h-5" *ngElse>
                      <p class="text-amber600 text-center">No disponible</p>
                    </div>
                  </div>
                </td>
                <td scope="col" class="px-1 py-[2px] xs:hidden">
                  <input
                    placeholder="Solicita"
                    autocomplete="off"
                    type="text"
                    class="bg-transparent"
                    id="input-table"
                    [(ngModel)]="r.residente"
                    (keydown.enter)="editarRequisicion(r)"
                  />
                </td>
                <td scope="col" class="px-1 py-[2px] min-w-2 xs:hidden">
                  <input
                    placeholder="Observaciones..."
                    readonly
                    autocomplete="off"
                    type="text"
                    class="bg-transparent"
                    id="input-table"
                    [(ngModel)]="r.observaciones"
                    (click)="editarObservacion(r); focus()"
                  />
                </td>
                <td
                  class="px-1 py-[2px] min-w-2 flex gap-2 justify-center"
                  scope="col"
                >
                  <div *ngIf="!insumosEstado">
                    <img
                      ngbTooltip="Ver insumos"
                      triggers="mouseenter:mouseleave"
                      class="cursor-pointer xs:w-4"
                      src="./assets/visibility_btn.svg"
                      alt="ver insumos"
                      (click)="verInsumos(r)"
                    />
                  </div>
                  <div *ngIf="insumosEstado">
                    <img
                      ngbTooltip="Cerrar insumos"
                      triggers="mouseenter:mouseleave"
                      class="cursor-pointer xs:w-4"
                      src="./assets/visibility-off_btn.svg"
                      alt="ver insumos"
                      (click)="verInsumos(r); ocultarTextArea()"
                    />
                  </div>

                  <img
                    ngbTooltip="Eliminar"
                    triggers="mouseenter:mouseleave"
                    class="cursor-pointer xs:w-4"
                    src="./assets/delete.svg"
                    (click)="eliminarRequisicion(r.id)"
                    alt="Delete icon"
                  />
                </td>
              </tr>
            </ng-container>
          </tbody>
        </table>
      </div>
      <!-- Description field -->
      <div class="mb-2 mt-2" *ngIf="veiewInsumos">
        <div>
          <p class="text-gray700 font-medium px-2">{{ descripcionTitulo }}</p>
        </div>
        <textarea
          #testInput
          #textarea
          [(ngModel)]="observacion"
          (keydown.enter)="editaObservacionTextArea()"
          style="width: 100%; display: none"
          rows="2"
          class="resize-none p-1 text-sm bg-white rounded-t-lg border"
          placeholder="Descripción..."
        ></textarea>
      </div>
      <!-- Description field end -->

      <!-- Pagination -->
      <div
        class="w-full bg-[#ffffff] flex justify-end rounded-md sticky left-0"
        *ngIf="!veiewInsumos && requisiciones.length > 10"
      >
        <div class="flex items-center xs:text-[10px]">
          {{ getPaginationInfo() }}
        </div>
        <nav class="p-2">
          <ul class="flex">
            <li class="flex items-center">
              <a
                class="mx-1 flex h-7 w-7 items-center justify-center rounded-full border border-blue-gray-100 bg-transparent p-0 text-sm text-blue-gray-500 transition duration-150 ease-in-out hover:bg-[#2d748d] cursor-pointer"
                (click)="previousPage()"
                aria-label="Previous"
              >
                <span class="material-icons text-[10px]"
                  >keyboard_arrow_left</span
                >
              </a>
            </li>
            <li *ngFor="let page of visiblePages" class="flex items-center">
              <a
                class="mx-1 flex h-7 w-7 items-center justify-center rounded-full hover:bg-colorButtonHover cursor-pointer xs:text-[10px]"
                [ngClass]="{
                  'bg-colorButton text-[#ffffff] shadow-md':
                    currentPage === page,
                  'border border-blue-gray-100 bg-transparent text-blue-gray-500 hover:bg-[#2d748d]':
                    currentPage !== page
                }"
                [class.active]="page === currentPage"
                (click)="goToPage(page)"
              >
                {{ page }}
              </a>
            </li>
            <li class="flex items-center">
              <a
                class="mx-1 flex h-7 w-7 items-center justify-center rounded-full border border-blue-gray-100 bg-transparent p-0 text-sm text-blue-gray-500 transition duration-150 ease-in-out hover:bg-light-300 cursor-pointer"
                (click)="nextPage()"
                aria-label="Next"
              >
                <span class="material-icons text-[10px]"
                  >keyboard_arrow_right</span
                >
              </a>
            </li>
          </ul>
        </nav>
      </div>
      <!-- Pagination end -->
    </div>
  </div>

  <!-- Sections -->
  <div *ngIf="veiewInsumos">
    <mat-tab-group
      class="first-custom-tab-group mt-3 z-40"
      animationDuration="1ms"
      (selectedTabChange)="yourFn($event)"
      [selectedIndex]="selectedIndex"
    >
      <mat-tab label="Insumos Requisición">
        <div *ngIf="selectedIndex === 0">
          <app-insumos-requicicion
            *appRecarga="appRecarga"
            [idEmpresaInput]="selectedEmpresa"
            (enviarAlerta)="alerta($event.tipo, $event.mensaje)"
            (recargar)="refresh($event)"
            [idRequisicionInput]="selectedRequisicion"
          ></app-insumos-requicicion>
        </div>
      </mat-tab>
      <mat-tab label="Cotización">
        <div *ngIf="selectedIndex === 1">
          <app-cotizacion
            *appRecarga="appRecarga"
            (enviarAlerta)="alerta($event.tipo, $event.mensaje)"
            [idRequisicionInput]="selectedRequisicion"
          >
          </app-cotizacion>
        </div>
      </mat-tab>
      <mat-tab label="Resumen Cotizaciones">
        <div *ngIf="selectedIndex === 2">
          <app-cotizaciones
            *appRecarga="appRecarga"
            [idEmpresaInput]="selectedEmpresa"
            [idRequisicionInput]="selectedRequisicion"
            (enviarAlerta)="alerta($event.tipo, $event.mensaje)"
            (valueChange)="insumosXcotizacion($event)"
            (valueChangeOC)="ordenesCompras($event)"
            (recargar)="recargar($event)"
          ></app-cotizaciones>
        </div>
      </mat-tab>
      <mat-tab label="Órdenes de Compra">
        <div *ngIf="selectedIndex === 3">
          <app-ordenes-compras
            *appRecarga="appRecarga"
            [idEmpresaInput]="selectedEmpresa"
            [idRequisicionInput]="selectedRequisicion"
            [idCotizacionInput]="idCotizacionparaOC"
            (valueChangeIOC)="insumosOrdenesCompras($event)"
            (valueChangeTodosOC)="removerValoresIdC($event)"
            (valueChangeEA)="entradasAlmacen($event)"
          >
          </app-ordenes-compras>
        </div>
      </mat-tab>
      <mat-tab label="Entradas de Almacen">
        <div *ngIf="selectedIndex === 4">
          <app-almacenes-entradas
            *appRecarga="appRecarga"
            [idEmpresaInput]="selectedEmpresa"
            [idRequisicionInput]="selectedRequisicion"
            [idCotizacionInput]="idCotizacionparaOC"
            [idOrdenCompraInput]="idOrdenCompraParaEA"
            [idProyectoInput]="idProyecto"
            (valueChangeTodosEA)="removerValoresIdOCparaEA($event)"
            (valueChangeInsumosEA)="insumosEntradaAlmacen($event)"
          >
          </app-almacenes-entradas>
        </div>
      </mat-tab>
    </mat-tab-group>
  </div>
  <!-- Sections -->
</section>
